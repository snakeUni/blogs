# React.forwardRef

`forwardRef` ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³é«˜é˜¶ç»„ä»¶ä¸­æ— æ³•æ‹¿åˆ°refçš„é—®é¢˜ï¼Œä»¥åŠåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ°åŸç”Ÿçš„DOMå…ƒç´   [forwardRef](https://reactjs.org/docs/react-api.html#reactforwardref)  

æ¥ä¸‹æ¥ä¸»è¦çœ‹ä¸‹ `forwardRef` çš„ç”¨æ³•ï¼Œä»¥åŠåœ¨ `hooks` ä¸­çš„ç›¸å…³ç”¨æ³•

## é«˜é˜¶ç»„ä»¶ä¸­çš„ `ref`

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œ æƒ³è¦è°ƒç”¨åŸç”Ÿçš„äº‹ä»¶ï¼Œ æˆ‘ä»¬çš„åšæ³•é€šå¸¸æ˜¯æš´éœ²ä¸€ä¸ªæ–¹æ³•ï¼Œ åœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨åŸç”Ÿçš„æ–¹æ³•ï¼Œ æ¯”å¦‚ `input` çš„ `focus` äº‹ä»¶



```jsx
class Input extends React.Component {

  focus = () => {
    this.inputRef.focus()
  }

  render() {
    return (
      <input ref={el => this.inputRef = el}/>
    )
  }
}
```

åœ¨ç»„ä»¶å¤–éƒ¨ï¼Œ æƒ³è¦ä¸»åŠ¨ä½¿ `input` èšç„¦ 

```jsx
const testRef = React.createRef()

<Input ref={testRef} />

testRef.current.focus()
```

ç”¨è¿‡ä¼ é€’ `ref`, è°ƒç”¨ç»„ä»¶å†…éƒ¨çš„ `focus` æ–¹æ³•ï¼Œ ä½¿ `input` ä¸»åŠ¨èšç„¦  

é‚£å¦‚æœæ­¤æ—¶æœ‰ä¸€ä¸ªé«˜é˜¶ç»„ä»¶å°è£…äº†è¿™ä¸ª `Input` ç»„ä»¶ å¦‚ä½•è°ƒç”¨ `focus` ä½¿ input ä¸»åŠ¨èšç„¦  

```jsx
function Hoc() {
  return <Input />
}

<Hoc />
```

æ­¤æ—¶ï¼Œ å¦‚ä½•è°ƒç”¨ `Input` é‡Œçš„ `focus` æ–¹æ³•ï¼Œ ä¼¼ä¹æ˜¯æ²¡æœ‰åŠæ³•(ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘ä¸çŸ¥é“), `forwardRef` ç”±æ­¤è€Œç”Ÿ

```jsx
const testRef = React.createRef()

function Hoc(props, ref) {
  return <Input {...props} ref={ref}/>
}

React.forwardRef(Hoc)

<Hoc ref={testRef}/>

testRef.current.focus()
```

æ­¤æ—¶ `testRef.current.focus()` å°±å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œ ä½¿ `input` èšç„¦

## å‡½æ•°å¼ç»„ä»¶  ç›´æ¥æ“ä½œ `DOM`

æˆ‘ä»¬ä¸å¦¨æŠŠ  `Input` æ”¹æ­£å‡½æ•°å¼ç»„ä»¶

```jsx
const Input = (props, ref) => {
  return (
    <input {...props} ref={ref}/>
  )
}

export default forwardRef(Input)
```

æ­¤æ—¶ `Input` çš„ `ref` ç›´æ¥æŒ‚åœ¨åˆ° `DOM` ä¸Šäº†ï¼Œ ä¸ºäº†ä½¿ `input` èšç„¦

```jsx
const inputRef = React.createRef()

<Input ref={inputRef}/>

inputRef.current.focus() // èšç„¦ ğŸ˜Š
inputRef.current.blur() // å¤±ç„¦ ğŸ˜ˆ
```

## hooks ä¸­ä½¿ç”¨

å¦‚æœæƒ³è¦è¾¾åˆ°å’Œ `class` ç›¸åŒçš„æ•ˆæœï¼Œ åœ¨å‡½æ•°ä¸­è¯¥å¦‚ä½•åš, `hooks` æä¾›äº†ç›¸åº”çš„api

```jsx
function Input(props, ref) {
  const inputRef = React.useRef();
  React.useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    },
    blur: () => {
      inputRef.current.blur();
    }
  }));
  return <input ref={inputRef} />;
}

export default forwardRef(Input);
```

ä½¿ç”¨ `Input`

```jsx
const inputRef = React.useRef()

<Input ref={inputRef} />

inputRef.current.focus() // èšç„¦ ğŸ˜Š
inputRef.current.blur() // å¤±ç„¦ ğŸ˜ˆ
```

æƒ³è¦è¯¦ç»†äº†è§£ï¼Œ å‰å¾€ [å®˜ç½‘](https://reactjs.org/docs/react-api.html#reactforwardref) 

`React` å®˜ç½‘å›¢é˜Ÿ æœ‰äº†æ–°çš„[æè®®](https://github.com/reactjs/rfcs/pull/107#issuecomment-466304382)å¯èƒ½ä¼šè§£å†³ `forwardRef` è¿™ç§å¤æ‚çš„ç”¨æ³•