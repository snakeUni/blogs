æ˜¨å¤©æ˜¯ `10æœˆ1æ—¥` å›½åº†èŠ‚ï¼Œé¦–å…ˆç¥è´ºä¼Ÿå¤§çš„ç¥–å›½ 70 å¹´ç”Ÿæ—¥å¿«ä¹ï¼ï¼ï¼ï¼

ä»Šå¤©æ˜¯å›½åº†èŠ‚çš„ç¬¬äºŒå¤©ï¼Œåœ¨è¿™é‡Œå…ˆç¥ç¦å¤§å®¶å›½åº†èŠ‚å¿«ä¹ï¼Œåƒå¥½å–å¥½ï¼ï¼ï¼

ä»Šå¤©é—²æ¥æ— äº‹ï¼Œä¸ç”±è‡ªç”±çš„å°±å¼€äº†ç”µè„‘ï¼Œè¿™å¯èƒ½æ˜¯åšæŠ€æœ¯çš„äººçš„é€šç—…ï¼Ÿæ„Ÿè§‰æœ‰çš„æ—¶å€™ä¸è‡ªè§‰å°±ä¼šæ‰“å¼€ç”µè„‘ï¼Œçœ‹äº›æŠ€æœ¯
æ–‡ç« å‘€ä»€ä¹ˆçš„ã€‚æ­£å¥½åœ¨çœ‹æ–‡ç« çš„æ—¶å€™ï¼Œæƒ³èµ·æ¥ä¹‹å‰åœ¨å·¥ä½œä¸­äº¦æ˜¯æ˜¯åœ¨å­¦ä¹ ä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä»Šå¤©å°±åœ¨è¿™ç¯‡æ–‡ç« é‡Œæ€»ç»“
ä¸€ä¸‹å§ã€‚

## ç›®å½•

- å¸¸è§ `Hook` çš„ç”¨æ³•
- `Hook` çš„æ³¨æ„é¡¹ä»¥åŠè§„åˆ™
- å¦‚ä½•å¤„ç† `Hook` çš„ä¾èµ–

### å¸¸è§ `Hook` çš„ç”¨æ³•

React å‘å¸ƒäº†å¾ˆå¤š `Hook`, ä»Šå¤©åœ¨è¿™ç¯‡æ–‡ç« é‡Œä¸»è¦å‡å°‘å‡ ä¸ª Hook åˆ†åˆ«æ˜¯ `useEffect`, `useMemo`, `useCallback`
ä¸ºä»€ä¹ˆåªä»‹ç»è¿™ä¸‰ä¸ªï¼Œå› ä¸ºè¿™ä¸‰ä¸ªéƒ½æ¶‰åŠåˆ°ä¾èµ–é¡¹çš„é—®é¢˜ã€‚`useLayoutEffect` è¿™ä¸ªä¸ç®—è¯¦ç»†ä»‹ç»ï¼Œå‚è€ƒ `useEffect` å³å¯

#### useEffect

`useEffect` çš„ç”¨æ³•å¾ˆç®€å•ï¼Œè¿™ä¸ª Hook é€šå¸¸æ˜¯ç”¨æ¥å¤„ç†ä¸€äº›å‰¯ä½œç”¨çš„ï¼Œæ¯”å¦‚æ•°æ®è¯·æ±‚ã€‚ä½ å¯ä»¥å½“åš class ä¸­çš„
`componentDidMount` å’Œ `componentDidUpdate` çš„ç»“åˆä½“æ¥ä½¿ç”¨ã€‚ä»¥å‰éœ€è¦è¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠè¯·æ±‚æ•°æ®çš„
æ“ä½œæ”¾åœ¨ `componentDidMount` ä¸­ã€‚æ¯”å¦‚

```js{2-4}
class Text extends React.Component {
  componentDidMount() {
    fetch('').then(result => {});
  }
}
```

ä½†æ˜¯åœ¨ Hook é‡Œå°±å¯ä»¥è¿™æ ·å»å†™

```js
useEffect(() => {
  fetch('').then(result => {});
}, []);
```

æ­¤æ—¶éœ€è¦æ³¨æ„çš„å°±æ˜¯ `ä¾èµ–é¡¹` çš„é—®é¢˜ï¼Œè¿™ä¸ªä¾‹å­ä¸­ä¾èµ–é¡¹æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé‚£ä¹ˆå°±ä»£è¡¨åªåœ¨ `mount` çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼Œ
ä¸‹ä¸€æ¬¡ä¸ä¼šæ‰§è¡Œè¿™ä¸ª `Hook`ã€‚

åŒç†ï¼Œ `useEffect` ä¹Ÿå¯ä»¥å–ä»£ `componentDidUpdate`ã€‚æ¯”å¦‚åœ¨ class ä¸­ä½¿ç”¨ `update`

```js
class Text extends React.Component {
  componentDidUpdate(preProps, preState) {
    if (preProps.xx !== this.props.xx) {
      // doing
    }
  }
}
```

åœ¨ `Hook` é‡Œå°±å¯ä»¥è¿™æ ·å»å†™

```js
useEffect(() => {
  // doing
}, [props.xx]);
```

åªè¦å½“ `xx` å‘ç”Ÿå˜åŒ–çš„æ—¶å€™å°±æ‰§è¡Œè¿™ä¸ª `effect`ã€‚ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚

### `Hook` çš„æ³¨æ„é¡¹ä»¥åŠè§„åˆ™

åœ¨ä½¿ç”¨ `Hook` çš„æ—¶å€™ä¸€å®šè¦éµå¾ªå®ƒçš„[è§„åˆ™](https://reactjs.org/docs/hooks-rules.html?no-cache=1)

Donâ€™t call Hooks from regular JavaScript functions. Instead, you can:

- âœ… Call Hooks from React function components.
- âœ… Call Hooks from custom Hooks (weâ€™ll learn about them on the next page).

å¿…é¡»è¦éµå¾ªä¸Šè¿°çš„è§„åˆ™ï¼Œæ‰èƒ½æ­£ç¡®çš„ä½¿ç”¨ `Hook`

### å¦‚ä½•å¤„ç† `Hook` çš„ä¾èµ–

åœ¨ä½¿ç”¨ `Hook` çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šè£…å®˜æ–¹æä¾›çš„ [hook eslint](https://www.npmjs.com/package/eslint-plugin-react-hooks) ä½¿ç”¨
å®˜æ–¹æä¾›çš„ eslint æœ‰å¾ˆå¤šå¥½å¤„ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…ä¸€äº›ä½¿ç”¨ hook çš„é”™è¯¯ï¼Œæ¯”å¦‚éœ€è¦åœ¨é¡¶å±‚ä½¿ç”¨ã€‚å¦‚æœä½ åœ¨æ¡ä»¶è¯­å¥ä¸­
ä½¿ç”¨å°±ä¼šæŠ¥é”™ã€‚ä½¿ç”¨ lint å‡å°‘äº†é”™è¯¯çš„å‘ç”Ÿã€‚ä½†æ˜¯ç›®å‰çš„ eslint æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šè¢«å¤§å®¶æ‰€è¯Ÿç—…å§ã€‚å°±æ˜¯è‡ªå®šæ·»åŠ ä¾èµ–çš„é—®é¢˜
å½“åœ¨ eslint ä¸­è¿™æ ·é…ç½®

```js
// Your ESLint configuration
{
  "plugins": [
    // ...
    "react-hooks"
  ],
  "rules": {
    // ...
    "react-hooks/rules-of-hooks": "error", // Checks rules of Hooks
    "react-hooks/exhaustive-deps": "warn" // Checks effect dependencies
  }
}
```

`react-hooks/exhaustive-deps` è¿™ä¸ªè§„åˆ™ä¼šæ£€æŸ¥ä¾èµ–é¡¹ï¼Œå¸¸è§æœ‰ `useEffect`, `useMemo`, `useCallback`
ä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå‡ ä¸ª `Hook` åŠ ä¸Šä¾èµ–ï¼Œé‚£ä¹ˆè¿™æ ·å°±ä¼šå­˜åœ¨é—®é¢˜ï¼Œæœ‰çš„æ—¶å€™å¯èƒ½æˆ‘å°±æ˜¯ä¸æƒ³è¦è¿™ä¸ªä¾èµ–ï¼Œä½†æ˜¯å› ä¸º lint é…ç½®äº†è¿™ä¸ª
çš„åŸå› ï¼Œè‡ªåŠ¨åŠ ä¸Šäº†ä¾èµ–ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆå»è§£å†³æˆ–è€…è¯´å¦‚ä½•ä¼˜é›…çš„æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿï¼ˆ`åˆ æ‰è¿™ä¸ªè§„åˆ™ç¾æ»‹æ»‹-æœ€å¥½ä¸è¦åˆ `ï¼‰

è¿™ä¸ªåœ¨ React çš„ github [issue](https://github.com/facebook/react/issues/14920) ä¸­æœ‰æåˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œå°±æ˜¯å¸Œæœ›åœ¨ä½¿ç”¨è¿™ä¸ª
è§„åˆ™çš„æ—¶å€™ä¸è¦è‡ªåŠ¨åŠ ä¸Šä¾èµ–ï¼Œå¯ä»¥ç»™å‡ºè­¦å‘Šï¼Œä½†æ˜¯ä¸è¦è‡ªåŠ¨æ·»åŠ åˆ°ä»£ç ä¸­ã€‚ä»Šå¤©ä»å®˜æ–¹çš„ issue æ¥åˆ†æä¸€ä¸ªä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼Œæ˜¯å¦å¯ä»¥åœ¨ä¸å»æ‰è¿™ä¸ª
è§„åˆ™çš„å‰æä¸‹ï¼Œè§£å†³è¿™æ ·çš„ä¾èµ–é—®é¢˜ã€‚

#### Example-1

[codesandbox](https://codesandbox.io/s/nqy69ol00)

This is an uncontrolled Checkbox component which takes a defaultIndeterminate prop to set the indeterminate status on initial render (which can only be done in JS using a ref because there's no indeterminate element attribute). This prop is intended to behave like defaultValue, where its value is used only on initial render.

The rule complains that defaultIndeterminate is missing from the dependency array, but adding it would cause the component to incorrectly overwrite the uncontrolled state if a new value is passed. The dependency array can't be removed entirely because it would cause the indeterminate status to be fully controlled by the prop.

I don't see any way of distinguishing between this and the type of case that the rule is meant to catch, but it would be great if the final rule documentation could include a suggested workaround. ğŸ™‚

`åŸå§‹ä»£ç ç‰‡æ®µ`

```js{9-13}
import React from 'react';
import ReactDOM from 'react-dom';

function Checkbox(props) {
  const { defaultIndeterminate, ...rest } = props;

  const inputRef = React.useRef(null);

  React.useLayoutEffect(() => {
    if (defaultIndeterminate != null && inputRef.current) {
      inputRef.current.indeterminate = defaultIndeterminate;
    }
  }, []);

  return <input {...rest} ref={inputRef} type='checkbox' />;
}

const rootElement = document.getElementById('root');
ReactDOM.render(<Checkbox defaultIndeterminate />, rootElement);
```

è¿™ä¸ªä¾‹å­ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Šå°±æ˜¯ `useLayoutEffect` ç¼ºå°‘ä¸€ä¸ªä¾èµ–å°±æ˜¯ `defaultIndeterminate`, é‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªä¾èµ–æ”¾åœ¨
è¿™é‡Œæ˜¯å¦åˆé€‚å‘¢ï¼Ÿæ˜æ˜¾çœ‹å‡ºæ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸º `default` çš„æ•ˆæœæ˜¯ä»€ä¹ˆå°±æ˜¯åˆå§‹åŒ–æˆ–è€…è¯´åªå¯¹äº mount çš„æ—¶å€™èµ·ä½œç”¨ï¼Œä¸‹ä¸€æ¬¡
ä¿®æ”¹ default çš„å€¼ä¸åº”è¯¥ä¸åœ¨åº”ç”¨è¿™ä¸ªå€¼ã€‚ä½†æ˜¯å¦‚æœä½œä¸ºä¾èµ–ï¼Œé‚£ä¹ˆæ¯æ¬¡è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–éƒ½ä¼šå¯¼è‡´é‡æ–°åº”ç”¨è¿™ä¸ªå€¼ï¼Œå¦‚æœè¾¾åˆ°è¿™ä¸ªä½œç”¨
ä¸å°±æ˜¯ value çš„æ•ˆæœäº†å˜›ã€‚è€Œä¸æ˜¯ `defaultValue` æˆ– `defaultIndeterminate` çš„æ•ˆæœã€‚å¦‚æœè¦æƒ³è¾¾åˆ° default çš„æ•ˆæœåˆä¸æ˜¯
disabled lint, å¯ä»¥è¯•è¯•è¿™æ ·æ¥ä¿®æ”¹

```js{5}
function Checkbox(props) {
  const { defaultIndeterminate, ...rest } = props;

  const inputRef = React.useRef(null);
  const indeterminate = React.useState(defaultIndeterminate);

  React.useLayoutEffect(() => {
    if (indeterminate != null && inputRef.current) {
      inputRef.current.indeterminate = indeterminate;
    }
  }, [indeterminate]);

  return <input {...rest} ref={inputRef} type='checkbox' />;
}
```

ä½¿ç”¨ `useState` æŠŠ `indeterminate` ä½œä¸ºä¾èµ–ã€‚

æ€»ç»“ï¼š å¦‚æœè¦è¾¾åˆ° `default` çš„æ•ˆæœå…¶å®éƒ½å¯ä»¥è¿™ä¹ˆæ¥å¤„ç†ã€‚ä½¿ç”¨ useState å¯ä»¥è¾¾åˆ°ç¼“å­˜çš„æ•ˆæœ

#### Example-2

ç¬¬äºŒä¸ªåœºæ™¯è¿˜æ˜¯å¾ˆç®€å•çš„åœ¨ issue ä¸­æ˜¯è¿™æ ·çš„

```js
const foo = () => {...};
useEffect(() => {
    foo();
  }, []);
```

åœ¨å¤–éƒ¨åˆ›å»ºäº† `foo` å‡½æ•°ï¼Œä½†æ˜¯è°ƒç”¨éœ€è¦åœ¨ useEffect å†…éƒ¨è°ƒç”¨ä¹Ÿæœ‰å¯èƒ½åœ¨å…¶ä»–çš„äº‹ä»¶å‡½æ•°ä¸­è°ƒç”¨ã€‚è¿™ç§åœºæ™¯åœ¨å¼€å‘ä¸­è¿˜æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§ã€‚è¿™ç§åœºæ™¯ä¸‹
ä¼šæŠŠ `foo` åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚ä½†æ˜¯æ¯æ¬¡å½“ç»„ä»¶ `rerender` çš„æ—¶å€™, foo éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ç§åœºæ™¯ä¸‹å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ

è¿™ç§åˆ†ä¸¤ç§æƒ…å†µæ¥å¤„ç†ï¼Œç¬¬ä¸€å°±æ˜¯å¦‚æœå‡½æ•°åœ¨ `effect` å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°å¹¶ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±éœ€è¦`å£°æ˜åœ¨ effect å†…éƒ¨`,
ç¬¬äºŒå°±æ˜¯è¿™ä¸ªå‡½æ•°ä¸ä»…åœ¨ `effect` å†…éƒ¨ä¹Ÿéœ€è¦åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ã€‚é‚£ä¹ˆæ­¤æ—¶éœ€è¦ä½¿ç”¨ `useCallback` è¿›è¡ŒåŒ…è£¹èµ·æ¥ï¼Œåœ¨ `useCallback` ä¸­
å¤„ç†å¥½ä¾èµ–å…³ç³»å°±å¯ä»¥ã€‚ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ useState, ä¹‹å‰è¯´è¿‡ useState ä¹Ÿèƒ½èµ·åˆ°ç¼“å­˜çš„ä½œç”¨ã€‚é‚£ä¹ˆå¦‚æœå¯¹å‡½æ•°è¿›è¡Œç¼“å­˜ï¼Œä¹Ÿæ˜¯å¯ä»¥
è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœçš„

#### Example-3

å¦‚æœåœ¨ `useEffect` å†…éƒ¨ç›´æ¥ä½¿ç”¨ `props.xxx`, é‚£ä¹ˆæ­¤æ—¶ä¼šè‡ªåŠ¨æŠŠ props åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚æ¯”å¦‚

```js
useEffect(
  function() {
    props.setLoading(true);
  },
  [props.setLoading]
);
```

è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œæ‰€ä»¥å¯¹äºåœ¨ useEffect ä¸­ä½¿ç”¨ props, æœ€å¥½å…ˆè§£æ„å‡ºç›¸åº”çš„å±æ€§ã€‚ The best practice is always destructuring.

```js{1}
const { setLoading } = props;
useEffect(
  function() {
    setLoading(true);
  },
  [setLoading]
);
```

#### Example-4

è¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨äºæ•°æ®è¯·æ±‚çš„ä¾‹å­ï¼Œåœ¨ `useEffect` å†…éƒ¨å‘é€è¯·æ±‚

```js{21-29}
const useDataApi = url => {
  const [data, setData] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isError, setIsError] = useState(false);

  const fetchData = async () => {
    let response;
    setIsError(false);
    setIsLoading(true);

    try {
      response = await fetch(url).then(response => response.json());

      setData(response);
    } catch (error) {
      setIsError(true);
    }

    setIsLoading(false);
  };

  useEffect(
    () => {
      fetchData();
    },
    // react-hooks/exhaustive-deps gives me warning that I should put fetchData into
    // dependency array & remove url
    // if I put fetchData as a dependency and remove url the request will be fired continuously
    [url]
  );

  return { data, isLoading, isError };
};
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`useEffect` æ˜¯éœ€è¦ `fetchData` ä½œä¸ºä¾èµ–ï¼Œä½†æ˜¯å½“éœ€è¦å‡½æ•°ä½œä¸ºä¾èµ–çš„æ—¶å€™æ­£å¦‚ä¹‹å‰æ‰€è¯´çš„ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªã€‚ç¬¬ä¸€æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨å†…éƒ¨ï¼Œ
ç¬¬äºŒä½¿ç”¨ `useCallback`, ç¬¬ä¸‰ä½¿ç”¨ ref æˆ–è€… state è®°å½•è¯¥å‡½æ•°ã€‚å…¶å®è¿˜æœ‰ä¸€ç§å°±æ˜¯æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨è¿™ä¸ª `Hook` çš„å¤–éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä¸å¦¨æ¥ä¸€æ­¥ä¸€æ­¥çš„ä¿®æ”¹ã€‚
é¦–å…ˆæŠŠå‡½æ•°æ”¾åœ¨å†…éƒ¨åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

```js
useEffect(
  () => {
    const fetchData = async () => {
      let response;
      setIsError(false);
      setIsLoading(true);

      try {
        response = await fetch(url).then(response => response.json());

        setData(response);
      } catch (error) {
        setIsError(true);
      }

      setIsLoading(false);
    };

    fetchData();
  },
  // react-hooks/exhaustive-deps gives me warning that I should put fetchData into
  // dependency array & remove url
  // if I put fetchData as a dependency and remove url the request will be fired continuously
  [url]
);
```

<div>
  <img src={require('./data.jpg')} />
</div>

å¯ä»¥çœ‹å‡ºæ­¤æ—¶ä¾èµ–é—®é¢˜å·²ç»è§£å†³ã€‚å…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„å¤„ç†ï¼Œè¿™ä¸ªä¾‹å­å°±ä¸åšè¿‡å¤šçš„é˜è¿°ã€‚

#### Example-5

ç¬¬äº”ä¸ªä¾‹å­ä¹Ÿæ˜¯ä¸šåŠ¡ä¸­å¸¸è§çš„ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æ¨¡æ‹Ÿ `componentDidUpdate` æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼Œ `useEffect` æœ‰è¿™ä¸ªä½œç”¨ã€‚ä½†æ˜¯é‡åˆ°è¿™ç§æƒ…å†µ

```js
componentDidUpdate(preProps, preState) {
  if (preProps.xxx !== this.props.xxx) {
    fetchData(url)
  }
}
```

ä¾‹å­ä»£ç 

```js
const MyComponent = props => {
  const { getData, someId, refreshRequest } = props;

  useEffect(
    () => {
      const fetchData = () => {
        getData(someId);
      };
      fetchData();
    },
    [refreshRequest] //This is what I want -- just invoke useEffect on intial component mount and when refreshRequest is updated
    //[refreshRequest, someId, getData] //Linter wants everything in useEffect function second array argument, or nothing.  So, if any prop changes, then it will invoke useEffect. Not what I want
  );

  return (
    <div>
      My component has rendered. Check out the console for when data is
      'fetched'
    </div>
  );
};
```

è¿™ä¸ªåœ¨ `useEffect` ä¸­å¾ˆä¸å¥½å¤„ç†ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸º `fetchData` å’Œ `url` éƒ½è¢«è®¤ä¸ºæ˜¯ä¾èµ–ï¼Œå®é™…ä¸ŠçœŸæ­£çš„ä¾èµ–åº”è¯¥æ˜¯ `xxx`

```js
const { xxx, fetchData, url } = props;
useEffect(() => {
  fetchData(url);
}, [xxx]);
```

è¿™ä¸ªå°±ä¼šæŠ¥è­¦å‘Šã€‚é‚£ä¹ˆè¿™æ ·çš„é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼ŸæŒ‰ç…§ä¹‹å‰è¯´çš„æ–¹æ³•ï¼Œç¬¬ä¸€æˆ‘ä»¬ä½¿ç”¨ `useCallback` æ¥è¯•è¯•çœ‹

```js
const fetch = useCallback(() => {
  fetchData(url);
}, [fetchData, url]);

useEffect(() => {
  fetch();
}, [fetch]);
```

æ­¤æ—¶ `fetchData` å’Œ `url` éƒ½ä¼šè¢«åŠ åˆ°ä¾èµ–ä¸­ã€‚è¿™ä¸ªè¿˜æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºåªè¦ url æˆ– fetchData å˜åŒ–å°±ä¼šè§¦å‘æ•°æ®çš„è¯·æ±‚ï¼Œè€Œä¸ `xxx` è¿™ä¸ªå±æ€§æ¯«æ— å…³ç³»ã€‚è¿™ä¸ªä¾‹å­ä¸å¦¨åœ¨åˆ†æä¸€ä¸‹
ä½¿ç”¨äº† `props` ä½†æ˜¯æœ‰ä¸€äº› props æ˜¯ä¾èµ–äºå…¶ä»–çš„ props, è¿™ç§æ›´åƒæ˜¯ class ä¸­çš„ `getDerivedStateFromProps`. é‚£ä¹ˆä¸å¦¨æŒ‰ç…§è¿™ä¸ªæ–¹å‘æ¥å¤„ç†è¿™ä¸ªä¾èµ–çš„é—®é¢˜ã€‚ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•
`useState` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```js{4-7}
const [currentGetData, setCurrentGetData] = useState(getData);
const [prevRefreshRequest, setPrevRefreshRequest] = useState(refreshRequest);

if (prevRefreshRequest !== refreshRequest) {
  setPrevRefreshRequest(refreshRequest);
  setCurrentGetData(getData);
}

useEffect(() => {
  currentGetData(someId);
}, [currentGetData, someId]);
```

æ¨¡æ‹Ÿäº† `getDerivedStateFromProps` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸ªä¾‹å­å¹¶ä¸æ˜¯ä¸€ä¸ªå¯å–çš„ä¾‹å­ï¼Œå°†å¼‚æ­¥å‡½æ•°ä¼ é€’ä¸‹æ¥ã€‚å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç° `ç«æ€` çš„æƒ…å†µã€‚å°±æ˜¯ä¸¤ä¸ªè¯·æ±‚å‘å‡ºçš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚æ¯”
ç¬¬äºŒä¸ªè¯·æ±‚è¦æ…¢ã€‚å®é™…ä¸Šæˆ‘ä»¬éœ€è¦æ˜¯ç¬¬äºŒä¸ªè¯·æ±‚è¿”å›çš„ç»“æœã€‚æ‰€ä»¥æœ€å¥½å¤„ç†å¥½è¿™æ ·çš„é—®é¢˜ã€‚å¦‚æœè¯·æ±‚æ•°æ®çš„å°±æ˜¯è¿™ä¸ªç»„ä»¶çš„æœ¬èº«çš„è¯ï¼Œå¯ä»¥åœ¨ `useEffect` çš„ clean å‡½æ•°ä¸­è®¾ç½®`å¿½ç•¥`æ ‡å¿—ä»¥è§£å†³è¿™ç§
`ç«æ€`çš„åœºæ™¯ã€‚å½“ç„¶å¦‚æœ `React` åç»­çš„ `Suspense` å‡ºæ¥äº†ï¼Œæ•°æ®è¯·æ±‚æ”¾åœ¨ `Suspense` ä¸­æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚

## Conclusion

å¯¹äºä½¿ç”¨ `useEffect` çš„ä¾èµ–å¯ä»¥é‡‡å–å››ç§æ–¹å¼æ¥è§£å†³ã€‚

- ä½¿ç”¨ `useState` è¿›è¡Œç¼“å­˜ã€‚åŒæ—¶å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿ class ä¸­çš„ `getDerivedStateFromProps`
- å¯¹äºåœ¨ `useEffect` å¤–éƒ¨çš„å£°æ˜ï¼Œå†…éƒ¨åˆè¦ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚å¯ä»¥æ”¾å…¥åˆ° `useEffect` å†…éƒ¨
- å¯¹äºä¸èƒ½æ”¾åœ¨ `useEffect` å†…éƒ¨çš„ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å¦ä½¿ç”¨ `useCallback` æ¥è§£å†³è¿™æ ·çš„é—®é¢˜
- ä½¿ç”¨ `ref` æˆ–è€… æ”¾åˆ°ç»„ä»¶å¤–é¢

å¯¹äºè¿™ä¸ª [Feedback for 'exhaustive-deps' lint rule](https://github.com/facebook/react/issues/14920) Dan ä¹Ÿåœ¨é‡Œé¢ç»™å‡ºäº†ä¸€äº›è§£å†³åŠæ³•ã€‚å¯ä»¥å‚è€ƒ
