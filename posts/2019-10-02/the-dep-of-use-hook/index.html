<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="shortcut icon" href="./fa.jpg"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="theme-color" content="#000000"/><link rel="manifest" href="./manifest.json"/>
    <title>the dep of useHook</title>
    <link rel="canonical" href="/posts/2019-10-02/the-dep-of-use-hook" />
    <link rel="stylesheet" href="./static/css/1.27c8494b.chunk.css" />
  <link href="./static/css/main.0e6724e3.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__1wjbv"><div class="
        LoadingIndicator_LoadingIndicator__LXZCC
        
        undefined
      "></div><header><h3 class="BlogLayout_title__U0zfd"><a class=" " href="/">lanyincao</a></h3></header><main><article><header class="BlogPostLayout_header__6lPZ1"><h1 class="BlogPostLayout_title__1egAZ"><a class=" " href="/posts/2019-10-02/the-dep-of-use-hook/">the dep of useHook</a></h1><small><time dateTime="Tue, 01 Oct 2019 16:00:00 GMT">October 2, 2019</time> <!-- -->â€¢<!-- --> <ul class="ArticleMeta_tags__30Wbg"><li><a class=" " href="/tags/react/">react</a></li><li><a class=" " href="/tags/little/">little</a></li></ul> <!-- -->â€¢<!-- --> <span>â˜•ï¸<!-- --> <!-- -->5<!-- --> min read</span></small></header><div class="BlogPostLayout_content__1CRXP"><p>æ˜¨å¤©æ˜¯ <code>10æœˆ1æ—¥</code> å›½åº†èŠ‚ï¼Œé¦–å…ˆç¥è´ºä¼Ÿå¤§çš„ç¥–å›½ 70 å¹´ç”Ÿæ—¥å¿«ä¹ï¼ï¼ï¼ï¼</p><p>ä»Šå¤©æ˜¯å›½åº†èŠ‚çš„ç¬¬äºŒå¤©ï¼Œåœ¨è¿™é‡Œå…ˆç¥ç¦å¤§å®¶å›½åº†èŠ‚å¿«ä¹ï¼Œåƒå¥½å–å¥½ï¼ï¼ï¼</p><p>ä»Šå¤©é—²æ¥æ— äº‹ï¼Œä¸ç”±è‡ªç”±çš„å°±å¼€äº†ç”µè„‘ï¼Œè¿™å¯èƒ½æ˜¯åšæŠ€æœ¯çš„äººçš„é€šç—…ï¼Ÿæ„Ÿè§‰æœ‰çš„æ—¶å€™ä¸è‡ªè§‰å°±ä¼šæ‰“å¼€ç”µè„‘ï¼Œçœ‹äº›æŠ€æœ¯
æ–‡ç« å‘€ä»€ä¹ˆçš„ã€‚æ­£å¥½åœ¨çœ‹æ–‡ç« çš„æ—¶å€™ï¼Œæƒ³èµ·æ¥ä¹‹å‰åœ¨å·¥ä½œä¸­äº¦æ˜¯æ˜¯åœ¨å­¦ä¹ ä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä»Šå¤©å°±åœ¨è¿™ç¯‡æ–‡ç« é‡Œæ€»ç»“
ä¸€ä¸‹å§ã€‚</p><h2 id="ç›®å½•">ç›®å½•</h2><ul><li>å¸¸è§ <code>Hook</code> çš„ç”¨æ³•</li><li><code>Hook</code> çš„æ³¨æ„é¡¹ä»¥åŠè§„åˆ™</li><li>å¦‚ä½•å¤„ç† <code>Hook</code> çš„ä¾èµ–</li></ul><h3 id="å¸¸è§-hook-çš„ç”¨æ³•">å¸¸è§ <code>Hook</code> çš„ç”¨æ³•</h3><p>React å‘å¸ƒäº†å¾ˆå¤š <code>Hook</code>, ä»Šå¤©åœ¨è¿™ç¯‡æ–‡ç« é‡Œä¸»è¦å‡å°‘å‡ ä¸ª Hook åˆ†åˆ«æ˜¯ <code>useEffect</code>, <code>useMemo</code>, <code>useCallback</code>
ä¸ºä»€ä¹ˆåªä»‹ç»è¿™ä¸‰ä¸ªï¼Œå› ä¸ºè¿™ä¸‰ä¸ªéƒ½æ¶‰åŠåˆ°ä¾èµ–é¡¹çš„é—®é¢˜ã€‚<code>useLayoutEffect</code> è¿™ä¸ªä¸ç®—è¯¦ç»†ä»‹ç»ï¼Œå‚è€ƒ <code>useEffect</code> å³å¯</p><h4 id="useeffect">useEffect</h4><p><code>useEffect</code> çš„ç”¨æ³•å¾ˆç®€å•ï¼Œè¿™ä¸ª Hook é€šå¸¸æ˜¯ç”¨æ¥å¤„ç†ä¸€äº›å‰¯ä½œç”¨çš„ï¼Œæ¯”å¦‚æ•°æ®è¯·æ±‚ã€‚ä½ å¯ä»¥å½“åš class ä¸­çš„
<code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> çš„ç»“åˆä½“æ¥ä½¿ç”¨ã€‚ä»¥å‰éœ€è¦è¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠè¯·æ±‚æ•°æ®çš„
æ“ä½œæ”¾åœ¨ <code>componentDidMount</code> ä¸­ã€‚æ¯”å¦‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="2,3,4"><span class="token keyword">class</span> <span class="token class-name">Text</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
<span class="highlighted-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="highlighted-line">    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="highlighted-line">  <span class="token punctuation">}</span></span><span class="token punctuation">}</span>
</code></pre><p>ä½†æ˜¯åœ¨ Hook é‡Œå°±å¯ä»¥è¿™æ ·å»å†™</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>æ­¤æ—¶éœ€è¦æ³¨æ„çš„å°±æ˜¯ <code>ä¾èµ–é¡¹</code> çš„é—®é¢˜ï¼Œè¿™ä¸ªä¾‹å­ä¸­ä¾èµ–é¡¹æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé‚£ä¹ˆå°±ä»£è¡¨åªåœ¨ <code>mount</code> çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼Œ
ä¸‹ä¸€æ¬¡ä¸ä¼šæ‰§è¡Œè¿™ä¸ª <code>Hook</code>ã€‚</p><p>åŒç†ï¼Œ <code>useEffect</code> ä¹Ÿå¯ä»¥å–ä»£ <code>componentDidUpdate</code>ã€‚æ¯”å¦‚åœ¨ class ä¸­ä½¿ç”¨ <code>update</code></p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">class</span> <span class="token class-name">Text</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">preProps<span class="token punctuation">,</span> preState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>preProps<span class="token punctuation">.</span>xx <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>xx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// doing</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>åœ¨ <code>Hook</code> é‡Œå°±å¯ä»¥è¿™æ ·å»å†™</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// doing</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>xx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>åªè¦å½“ <code>xx</code> å‘ç”Ÿå˜åŒ–çš„æ—¶å€™å°±æ‰§è¡Œè¿™ä¸ª <code>effect</code>ã€‚ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚</p><h3 id="hook-çš„æ³¨æ„é¡¹ä»¥åŠè§„åˆ™"><code>Hook</code> çš„æ³¨æ„é¡¹ä»¥åŠè§„åˆ™</h3><p>åœ¨ä½¿ç”¨ <code>Hook</code> çš„æ—¶å€™ä¸€å®šè¦éµå¾ªå®ƒçš„<a class=" " href="https://reactjs.org/docs/hooks-rules.html?no-cache=1">è§„åˆ™</a></p><p>Donâ€™t call Hooks from regular JavaScript functions. Instead, you can:</p><ul><li>âœ… Call Hooks from React function components.</li><li>âœ… Call Hooks from custom Hooks (weâ€™ll learn about them on the next page).</li></ul><p>å¿…é¡»è¦éµå¾ªä¸Šè¿°çš„è§„åˆ™ï¼Œæ‰èƒ½æ­£ç¡®çš„ä½¿ç”¨ <code>Hook</code></p><h3 id="å¦‚ä½•å¤„ç†-hook-çš„ä¾èµ–">å¦‚ä½•å¤„ç† <code>Hook</code> çš„ä¾èµ–</h3><p>åœ¨ä½¿ç”¨ <code>Hook</code> çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šè£…å®˜æ–¹æä¾›çš„ <a class=" " href="https://www.npmjs.com/package/eslint-plugin-react-hooks">hook eslint</a> ä½¿ç”¨
å®˜æ–¹æä¾›çš„ eslint æœ‰å¾ˆå¤šå¥½å¤„ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…ä¸€äº›ä½¿ç”¨ hook çš„é”™è¯¯ï¼Œæ¯”å¦‚éœ€è¦åœ¨é¡¶å±‚ä½¿ç”¨ã€‚å¦‚æœä½ åœ¨æ¡ä»¶è¯­å¥ä¸­
ä½¿ç”¨å°±ä¼šæŠ¥é”™ã€‚ä½¿ç”¨ lint å‡å°‘äº†é”™è¯¯çš„å‘ç”Ÿã€‚ä½†æ˜¯ç›®å‰çš„ eslint æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šè¢«å¤§å®¶æ‰€è¯Ÿç—…å§ã€‚å°±æ˜¯è‡ªå®šæ·»åŠ ä¾èµ–çš„é—®é¢˜
å½“åœ¨ eslint ä¸­è¿™æ ·é…ç½®</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token comment">// Your ESLint configuration</span>
<span class="token punctuation">{</span>
  <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"rules"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks/rules-of-hooks"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token comment">// Checks rules of Hooks</span>
    <span class="token string">"react-hooks/exhaustive-deps"</span><span class="token punctuation">:</span> <span class="token string">"warn"</span> <span class="token comment">// Checks effect dependencies</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><code>react-hooks/exhaustive-deps</code> è¿™ä¸ªè§„åˆ™ä¼šæ£€æŸ¥ä¾èµ–é¡¹ï¼Œå¸¸è§æœ‰ <code>useEffect</code>, <code>useMemo</code>, <code>useCallback</code>
ä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå‡ ä¸ª <code>Hook</code> åŠ ä¸Šä¾èµ–ï¼Œé‚£ä¹ˆè¿™æ ·å°±ä¼šå­˜åœ¨é—®é¢˜ï¼Œæœ‰çš„æ—¶å€™å¯èƒ½æˆ‘å°±æ˜¯ä¸æƒ³è¦è¿™ä¸ªä¾èµ–ï¼Œä½†æ˜¯å› ä¸º lint é…ç½®äº†è¿™ä¸ª
çš„åŸå› ï¼Œè‡ªåŠ¨åŠ ä¸Šäº†ä¾èµ–ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆå»è§£å†³æˆ–è€…è¯´å¦‚ä½•ä¼˜é›…çš„æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿï¼ˆ<code>åˆ æ‰è¿™ä¸ªè§„åˆ™ç¾æ»‹æ»‹-æœ€å¥½ä¸è¦åˆ </code>ï¼‰</p><p>è¿™ä¸ªåœ¨ React çš„ github <a class=" " href="https://github.com/facebook/react/issues/14920">issue</a> ä¸­æœ‰æåˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œå°±æ˜¯å¸Œæœ›åœ¨ä½¿ç”¨è¿™ä¸ª
è§„åˆ™çš„æ—¶å€™ä¸è¦è‡ªåŠ¨åŠ ä¸Šä¾èµ–ï¼Œå¯ä»¥ç»™å‡ºè­¦å‘Šï¼Œä½†æ˜¯ä¸è¦è‡ªåŠ¨æ·»åŠ åˆ°ä»£ç ä¸­ã€‚ä»Šå¤©ä»å®˜æ–¹çš„ issue æ¥åˆ†æä¸€ä¸ªä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼Œæ˜¯å¦å¯ä»¥åœ¨ä¸å»æ‰è¿™ä¸ª
è§„åˆ™çš„å‰æä¸‹ï¼Œè§£å†³è¿™æ ·çš„ä¾èµ–é—®é¢˜ã€‚</p><h4 id="example-1">Example-1</h4><p><a class=" " href="https://codesandbox.io/s/nqy69ol00">codesandbox</a></p><p>This is an uncontrolled Checkbox component which takes a defaultIndeterminate prop to set the indeterminate status on initial render (which can only be done in JS using a ref because thereâ€™s no indeterminate element attribute). This prop is intended to behave like defaultValue, where its value is used only on initial render.</p><p>The rule complains that defaultIndeterminate is missing from the dependency array, but adding it would cause the component to incorrectly overwrite the uncontrolled state if a new value is passed. The dependency array canâ€™t be removed entirely because it would cause the indeterminate status to be fully controlled by the prop.</p><p>I donâ€™t see any way of distinguishing between this and the type of case that the rule is meant to catch, but it would be great if the final rule documentation could include a suggested workaround. ğŸ™‚</p><p><code>åŸå§‹ä»£ç ç‰‡æ®µ</code></p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="9,10,11,12,13"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Checkbox</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defaultIndeterminate<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="highlighted-line">  React<span class="token punctuation">.</span><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="highlighted-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultIndeterminate <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="highlighted-line">      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>indeterminate <span class="token operator">=</span> defaultIndeterminate<span class="token punctuation">;</span></span><span class="highlighted-line">    <span class="token punctuation">}</span></span><span class="highlighted-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Checkbox defaultIndeterminate <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>è¿™ä¸ªä¾‹å­ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Šå°±æ˜¯ <code>useLayoutEffect</code> ç¼ºå°‘ä¸€ä¸ªä¾èµ–å°±æ˜¯ <code>defaultIndeterminate</code>, é‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªä¾èµ–æ”¾åœ¨
è¿™é‡Œæ˜¯å¦åˆé€‚å‘¢ï¼Ÿæ˜æ˜¾çœ‹å‡ºæ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸º <code>default</code> çš„æ•ˆæœæ˜¯ä»€ä¹ˆå°±æ˜¯åˆå§‹åŒ–æˆ–è€…è¯´åªå¯¹äº mount çš„æ—¶å€™èµ·ä½œç”¨ï¼Œä¸‹ä¸€æ¬¡
ä¿®æ”¹ default çš„å€¼ä¸åº”è¯¥ä¸åœ¨åº”ç”¨è¿™ä¸ªå€¼ã€‚ä½†æ˜¯å¦‚æœä½œä¸ºä¾èµ–ï¼Œé‚£ä¹ˆæ¯æ¬¡è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–éƒ½ä¼šå¯¼è‡´é‡æ–°åº”ç”¨è¿™ä¸ªå€¼ï¼Œå¦‚æœè¾¾åˆ°è¿™ä¸ªä½œç”¨
ä¸å°±æ˜¯ value çš„æ•ˆæœäº†å˜›ã€‚è€Œä¸æ˜¯ <code>defaultValue</code> æˆ– <code>defaultIndeterminate</code> çš„æ•ˆæœã€‚å¦‚æœè¦æƒ³è¾¾åˆ° default çš„æ•ˆæœåˆä¸æ˜¯
disabled lint, å¯ä»¥è¯•è¯•è¿™æ ·æ¥ä¿®æ”¹</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="5"><span class="token keyword">function</span> <span class="token function">Checkbox</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defaultIndeterminate<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="highlighted-line">  <span class="token keyword">const</span> indeterminate <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span>defaultIndeterminate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  React<span class="token punctuation">.</span><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>indeterminate <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>indeterminate <span class="token operator">=</span> indeterminate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>indeterminate<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>ä½¿ç”¨ <code>useState</code> æŠŠ <code>indeterminate</code> ä½œä¸ºä¾èµ–ã€‚</p><p>æ€»ç»“ï¼š å¦‚æœè¦è¾¾åˆ° <code>default</code> çš„æ•ˆæœå…¶å®éƒ½å¯ä»¥è¿™ä¹ˆæ¥å¤„ç†ã€‚ä½¿ç”¨ useState å¯ä»¥è¾¾åˆ°ç¼“å­˜çš„æ•ˆæœ</p><h4 id="example-2">Example-2</h4><p>ç¬¬äºŒä¸ªåœºæ™¯è¿˜æ˜¯å¾ˆç®€å•çš„åœ¨ issue ä¸­æ˜¯è¿™æ ·çš„</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>åœ¨å¤–éƒ¨åˆ›å»ºäº† <code>foo</code> å‡½æ•°ï¼Œä½†æ˜¯è°ƒç”¨éœ€è¦åœ¨ useEffect å†…éƒ¨è°ƒç”¨ä¹Ÿæœ‰å¯èƒ½åœ¨å…¶ä»–çš„äº‹ä»¶å‡½æ•°ä¸­è°ƒç”¨ã€‚è¿™ç§åœºæ™¯åœ¨å¼€å‘ä¸­è¿˜æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§ã€‚è¿™ç§åœºæ™¯ä¸‹
ä¼šæŠŠ <code>foo</code> åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚ä½†æ˜¯æ¯æ¬¡å½“ç»„ä»¶ <code>rerender</code> çš„æ—¶å€™, foo éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ç§åœºæ™¯ä¸‹å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>è¿™ç§åˆ†ä¸¤ç§æƒ…å†µæ¥å¤„ç†ï¼Œç¬¬ä¸€å°±æ˜¯å¦‚æœå‡½æ•°åœ¨ <code>effect</code> å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°å¹¶ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±éœ€è¦<code>å£°æ˜åœ¨ effect å†…éƒ¨</code>,
ç¬¬äºŒå°±æ˜¯è¿™ä¸ªå‡½æ•°ä¸ä»…åœ¨ <code>effect</code> å†…éƒ¨ä¹Ÿéœ€è¦åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ã€‚é‚£ä¹ˆæ­¤æ—¶éœ€è¦ä½¿ç”¨ <code>useCallback</code> è¿›è¡ŒåŒ…è£¹èµ·æ¥ï¼Œåœ¨ <code>useCallback</code> ä¸­
å¤„ç†å¥½ä¾èµ–å…³ç³»å°±å¯ä»¥ã€‚ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ useState, ä¹‹å‰è¯´è¿‡ useState ä¹Ÿèƒ½èµ·åˆ°ç¼“å­˜çš„ä½œç”¨ã€‚é‚£ä¹ˆå¦‚æœå¯¹å‡½æ•°è¿›è¡Œç¼“å­˜ï¼Œä¹Ÿæ˜¯å¯ä»¥
è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœçš„</p><h4 id="example-3">Example-3</h4><p>å¦‚æœåœ¨ <code>useEffect</code> å†…éƒ¨ç›´æ¥ä½¿ç”¨ <code>props.xxx</code>, é‚£ä¹ˆæ­¤æ—¶ä¼šè‡ªåŠ¨æŠŠ props åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚æ¯”å¦‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">.</span><span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>props<span class="token punctuation">.</span>setLoading<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œæ‰€ä»¥å¯¹äºåœ¨ useEffect ä¸­ä½¿ç”¨ props, æœ€å¥½å…ˆè§£æ„å‡ºç›¸åº”çš„å±æ€§ã€‚ The best practice is always destructuring.</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="1"><span class="highlighted-line"><span class="token keyword">const</span> <span class="token punctuation">{</span> setLoading <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span></span><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>setLoading<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="example-4">Example-4</h4><p>è¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨äºæ•°æ®è¯·æ±‚çš„ä¾‹å­ï¼Œåœ¨ <code>useEffect</code> å†…éƒ¨å‘é€è¯·æ±‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="21,22,23,24,25,26,27,28,29"><span class="token keyword">const</span> <span class="token function-variable function">useDataApi</span> <span class="token operator">=</span> <span class="token parameter">url</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoading<span class="token punctuation">,</span> setIsLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isError<span class="token punctuation">,</span> setIsError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response<span class="token punctuation">;</span>
    <span class="token function">setIsError</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">setData</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsError</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="highlighted-line"></span><span class="highlighted-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span></span><span class="highlighted-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="highlighted-line">      <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="highlighted-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="highlighted-line">    <span class="token comment">// react-hooks/exhaustive-deps gives me warning that I should put fetchData into</span></span><span class="highlighted-line">    <span class="token comment">// dependency array &amp; remove url</span></span><span class="highlighted-line">    <span class="token comment">// if I put fetchData as a dependency and remove url the request will be fired continuously</span></span><span class="highlighted-line">    <span class="token punctuation">[</span>url<span class="token punctuation">]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>useEffect</code> æ˜¯éœ€è¦ <code>fetchData</code> ä½œä¸ºä¾èµ–ï¼Œä½†æ˜¯å½“éœ€è¦å‡½æ•°ä½œä¸ºä¾èµ–çš„æ—¶å€™æ­£å¦‚ä¹‹å‰æ‰€è¯´çš„ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªã€‚ç¬¬ä¸€æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨å†…éƒ¨ï¼Œ
ç¬¬äºŒä½¿ç”¨ <code>useCallback</code>, ç¬¬ä¸‰ä½¿ç”¨ ref æˆ–è€… state è®°å½•è¯¥å‡½æ•°ã€‚å…¶å®è¿˜æœ‰ä¸€ç§å°±æ˜¯æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨è¿™ä¸ª <code>Hook</code> çš„å¤–éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä¸å¦¨æ¥ä¸€æ­¥ä¸€æ­¥çš„ä¿®æ”¹ã€‚
é¦–å…ˆæŠŠå‡½æ•°æ”¾åœ¨å†…éƒ¨åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> response<span class="token punctuation">;</span>
      <span class="token function">setIsError</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setData</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setIsError</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// react-hooks/exhaustive-deps gives me warning that I should put fetchData into</span>
  <span class="token comment">// dependency array &amp; remove url</span>
  <span class="token comment">// if I put fetchData as a dependency and remove url the request will be fired continuously</span>
  <span class="token punctuation">[</span>url<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div><img src="./static/media/data.18efbfa5.jpg"/></div><p>å¯ä»¥çœ‹å‡ºæ­¤æ—¶ä¾èµ–é—®é¢˜å·²ç»è§£å†³ã€‚å…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„å¤„ç†ï¼Œè¿™ä¸ªä¾‹å­å°±ä¸åšè¿‡å¤šçš„é˜è¿°ã€‚</p><h4 id="example-5">Example-5</h4><p>ç¬¬äº”ä¸ªä¾‹å­ä¹Ÿæ˜¯ä¸šåŠ¡ä¸­å¸¸è§çš„ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯æ¨¡æ‹Ÿ <code>componentDidUpdate</code> æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼Œ <code>useEffect</code> æœ‰è¿™ä¸ªä½œç”¨ã€‚ä½†æ˜¯é‡åˆ°è¿™ç§æƒ…å†µ</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">preProps<span class="token punctuation">,</span> preState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>preProps<span class="token punctuation">.</span>xxx <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>ä¾‹å­ä»£ç </p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> <span class="token function-variable function">MyComponent</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> getData<span class="token punctuation">,</span> someId<span class="token punctuation">,</span> refreshRequest <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">getData</span><span class="token punctuation">(</span>someId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>refreshRequest<span class="token punctuation">]</span> <span class="token comment">//This is what I want -- just invoke useEffect on intial component mount and when refreshRequest is updated</span>
    <span class="token comment">//[refreshRequest, someId, getData] //Linter wants everything in useEffect function second array argument, or nothing.  So, if any prop changes, then it will invoke useEffect. Not what I want</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      My component has rendered<span class="token punctuation">.</span> Check out the console <span class="token keyword">for</span> when data is
      <span class="token string">'fetched'</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>è¿™ä¸ªåœ¨ <code>useEffect</code> ä¸­å¾ˆä¸å¥½å¤„ç†ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸º <code>fetchData</code> å’Œ <code>url</code> éƒ½è¢«è®¤ä¸ºæ˜¯ä¾èµ–ï¼Œå®é™…ä¸ŠçœŸæ­£çš„ä¾èµ–åº”è¯¥æ˜¯ <code>xxx</code></p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> <span class="token punctuation">{</span> xxx<span class="token punctuation">,</span> fetchData<span class="token punctuation">,</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>xxx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>è¿™ä¸ªå°±ä¼šæŠ¥è­¦å‘Šã€‚é‚£ä¹ˆè¿™æ ·çš„é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼ŸæŒ‰ç…§ä¹‹å‰è¯´çš„æ–¹æ³•ï¼Œç¬¬ä¸€æˆ‘ä»¬ä½¿ç”¨ <code>useCallback</code> æ¥è¯•è¯•çœ‹</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">,</span> url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>æ­¤æ—¶ <code>fetchData</code> å’Œ <code>url</code> éƒ½ä¼šè¢«åŠ åˆ°ä¾èµ–ä¸­ã€‚è¿™ä¸ªè¿˜æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºåªè¦ url æˆ– fetchData å˜åŒ–å°±ä¼šè§¦å‘æ•°æ®çš„è¯·æ±‚ï¼Œè€Œä¸ <code>xxx</code> è¿™ä¸ªå±æ€§æ¯«æ— å…³ç³»ã€‚è¿™ä¸ªä¾‹å­ä¸å¦¨åœ¨åˆ†æä¸€ä¸‹
ä½¿ç”¨äº† <code>props</code> ä½†æ˜¯æœ‰ä¸€äº› props æ˜¯ä¾èµ–äºå…¶ä»–çš„ props, è¿™ç§æ›´åƒæ˜¯ class ä¸­çš„ <code>getDerivedStateFromProps</code>. é‚£ä¹ˆä¸å¦¨æŒ‰ç…§è¿™ä¸ªæ–¹å‘æ¥å¤„ç†è¿™ä¸ªä¾èµ–çš„é—®é¢˜ã€‚ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•
<code>useState</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="4,5,6,7"><span class="token keyword">const</span> <span class="token punctuation">[</span>currentGetData<span class="token punctuation">,</span> setCurrentGetData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>getData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>prevRefreshRequest<span class="token punctuation">,</span> setPrevRefreshRequest<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>refreshRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="highlighted-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>prevRefreshRequest <span class="token operator">!==</span> refreshRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="highlighted-line">  <span class="token function">setPrevRefreshRequest</span><span class="token punctuation">(</span>refreshRequest<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="highlighted-line">  <span class="token function">setCurrentGetData</span><span class="token punctuation">(</span>getData<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="highlighted-line"><span class="token punctuation">}</span></span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">currentGetData</span><span class="token punctuation">(</span>someId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>currentGetData<span class="token punctuation">,</span> someId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>æ¨¡æ‹Ÿäº† <code>getDerivedStateFromProps</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸ªä¾‹å­å¹¶ä¸æ˜¯ä¸€ä¸ªå¯å–çš„ä¾‹å­ï¼Œå°†å¼‚æ­¥å‡½æ•°ä¼ é€’ä¸‹æ¥ã€‚å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç° <code>ç«æ€</code> çš„æƒ…å†µã€‚å°±æ˜¯ä¸¤ä¸ªè¯·æ±‚å‘å‡ºçš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚æ¯”
ç¬¬äºŒä¸ªè¯·æ±‚è¦æ…¢ã€‚å®é™…ä¸Šæˆ‘ä»¬éœ€è¦æ˜¯ç¬¬äºŒä¸ªè¯·æ±‚è¿”å›çš„ç»“æœã€‚æ‰€ä»¥æœ€å¥½å¤„ç†å¥½è¿™æ ·çš„é—®é¢˜ã€‚å¦‚æœè¯·æ±‚æ•°æ®çš„å°±æ˜¯è¿™ä¸ªç»„ä»¶çš„æœ¬èº«çš„è¯ï¼Œå¯ä»¥åœ¨ <code>useEffect</code> çš„ clean å‡½æ•°ä¸­è®¾ç½®<code>å¿½ç•¥</code>æ ‡å¿—ä»¥è§£å†³è¿™ç§
<code>ç«æ€</code>çš„åœºæ™¯ã€‚å½“ç„¶å¦‚æœ <code>React</code> åç»­çš„ <code>Suspense</code> å‡ºæ¥äº†ï¼Œæ•°æ®è¯·æ±‚æ”¾åœ¨ <code>Suspense</code> ä¸­æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><h2 id="conclusion">Conclusion</h2><p>å¯¹äºä½¿ç”¨ <code>useEffect</code> çš„ä¾èµ–å¯ä»¥é‡‡å–å››ç§æ–¹å¼æ¥è§£å†³ã€‚</p><ul><li>ä½¿ç”¨ <code>useState</code> è¿›è¡Œç¼“å­˜ã€‚åŒæ—¶å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿ class ä¸­çš„ <code>getDerivedStateFromProps</code></li><li>å¯¹äºåœ¨ <code>useEffect</code> å¤–éƒ¨çš„å£°æ˜ï¼Œå†…éƒ¨åˆè¦ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚å¯ä»¥æ”¾å…¥åˆ° <code>useEffect</code> å†…éƒ¨</li><li>å¯¹äºä¸èƒ½æ”¾åœ¨ <code>useEffect</code> å†…éƒ¨çš„ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å¦ä½¿ç”¨ <code>useCallback</code> æ¥è§£å†³è¿™æ ·çš„é—®é¢˜</li><li>ä½¿ç”¨ <code>ref</code> æˆ–è€… æ”¾åˆ°ç»„ä»¶å¤–é¢</li></ul><p>å¯¹äºè¿™ä¸ª <a class=" " href="https://github.com/facebook/react/issues/14920">Feedback for â€œexhaustive-depsâ€ lint rule</a> Dan ä¹Ÿåœ¨é‡Œé¢ç»™å‡ºäº†ä¸€äº›è§£å†³åŠæ³•ã€‚å¯ä»¥å‚è€ƒ</p></div><footer class="BlogPostLayout_footer__1p0Ii"><h3 class="BlogPostLayout_title__1egAZ"><a class=" " href="/">lanyincao</a></h3><div class="
      Bio_Bio__1eiKY
      BlogPostLayout_bio__2AHhA
    "><img src="./static/media/bio-pic.fdbb64ab.jpeg" alt="lanyincao"/><p>Personal blog by <a href="https://twitter.com/lanyincao">lanyincao</a>.<br/>I can&#x27;t sing, dance, rap but can code, ğŸ€</p></div><section class="BlogPostLayout_links__1fVhZ"><a class=" " href="/posts/2019-11-02/a-callback-thinking/">â† <!-- -->react callback thinking</a><a class="BlogPostLayout_next__3tOcG " href="/posts/2019-09-19/a-little-react/">A little About React<!-- --> â†’</a></section></footer></article></main></div></div><script>!function(o){function e(e){for(var t,r,n=e[0],c=e[1],f=e[2],d=0,a=[];d<n.length;d++)r=n[d],l[r]&&a.push(l[r][0]),l[r]=0;for(t in c)Object.prototype.hasOwnProperty.call(c,t)&&(o[t]=c[t]);for(p&&p(e);a.length;)a.shift()();return i.push.apply(i,f||[]),u()}function u(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var f=r[c];0!==l[f]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},a={43:0},l={43:0},i=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(i){var e=[];a[i]?e.push(a[i]):0!==a[i]&&{1:1,23:1}[i]&&e.push(a[i]=new Promise(function(e,n){for(var t="static/css/"+({}[i]||i)+"."+{1:"27c8494b",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"31d6cfe0",15:"31d6cfe0",16:"31d6cfe0",17:"31d6cfe0",18:"31d6cfe0",19:"31d6cfe0",20:"31d6cfe0",21:"31d6cfe0",22:"31d6cfe0",23:"d3b34b05",24:"31d6cfe0",25:"31d6cfe0",26:"31d6cfe0",27:"31d6cfe0",28:"31d6cfe0",29:"31d6cfe0",30:"31d6cfe0",31:"31d6cfe0",32:"31d6cfe0",33:"31d6cfe0",34:"31d6cfe0",35:"31d6cfe0",36:"31d6cfe0",37:"31d6cfe0",38:"31d6cfe0",39:"31d6cfe0",40:"31d6cfe0",41:"31d6cfe0"}[i]+".chunk.css",c=s.p+t,r=document.getElementsByTagName("link"),f=0;f<r.length;f++){var d=(o=r[f]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(d===t||d===c))return e()}var a=document.getElementsByTagName("style");for(f=0;f<a.length;f++){var o;if((d=(o=a[f]).getAttribute("data-href"))===t||d===c)return e()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=e,u.onerror=function(e){var t=e&&e.target&&e.target.src||c,r=new Error("Loading CSS chunk "+i+" failed.\n("+t+")");r.request=t,n(r)},u.href=c,document.getElementsByTagName("head")[0].appendChild(u)}).then(function(){a[i]=0}));var r=l[i];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[i]=[e,t]});e.push(r[2]=t);var n,c=document.getElementsByTagName("head")[0],f=document.createElement("script");f.charset="utf-8",f.timeout=120,s.nc&&f.setAttribute("nonce",s.nc),f.src=s.p+"static/js/"+({}[i]||i)+"."+{1:"18016ef5",2:"f51ae852",3:"2d812e0c",4:"959e45b9",5:"031228ef",6:"da64b01a",7:"c20265b4",8:"3708fc80",9:"76d5a1f1",10:"64d279dc",11:"15bdaa3d",12:"a289339e",13:"6ed3fae5",14:"c0219476",15:"1b2dfa34",16:"c95df50e",17:"854d2668",18:"fe4e0156",19:"75b2ab08",20:"5cc3e2dd",21:"85a6bb34",22:"f5b6dab9",23:"873b678f",24:"299ad1b2",25:"26732315",26:"8ed938bb",27:"9e08b9c8",28:"8c5bf47d",29:"651315e7",30:"4de03612",31:"a827ef55",32:"9f8e8c89",33:"4e98a6ac",34:"8fa7acd9",35:"f7fd16e7",36:"c8a9136e",37:"7fd46dad",38:"ab859197",39:"242ef20f",40:"a8b763a6",41:"fe59cd2f"}[i]+".chunk.js",n=function(e){f.onerror=f.onload=null,clearTimeout(d);var t=l[i];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,c=new Error("Loading chunk "+i+" failed.\n("+r+": "+n+")");c.type=r,c.request=n,t[1](c)}l[i]=void 0}};var d=setTimeout(function(){n({type:"timeout",target:f})},12e4);f.onerror=f.onload=n,c.appendChild(f)}return Promise.all(e)},s.m=o,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="./",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var c=0;c<t.length;c++)e(t[c]);var p=n;u()}([])</script><script src="./static/js/42.e4ff5a7a.chunk.js"></script><script src="./static/js/main.ec82054e.chunk.js"></script></body></html>