<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="shortcut icon" href="/fa.jpg"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="theme-color" content="#000000"/><link rel="manifest" href="/manifest.json"/>
    <title>dev sketch</title>
    <link rel="canonical" href="/posts/2019-11-26/dev-sketch" />
    <link rel="stylesheet" href="/static/css/1.27c8494b.chunk.css" />
  <link href="/static/css/main.0e6724e3.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__1wjbv"><div class="
        LoadingIndicator_LoadingIndicator__LXZCC
        
        undefined
      "></div><header><h3 class="BlogLayout_title__U0zfd"><a class=" " href="/">lanyincao</a></h3></header><main><article><header class="BlogPostLayout_header__6lPZ1"><h1 class="BlogPostLayout_title__1egAZ"><a class=" " href="/posts/2019-11-26/dev-sketch/">dev sketch</a></h1><small><time dateTime="Mon, 25 Nov 2019 16:00:00 GMT">November 26, 2019</time> <!-- -->â€¢<!-- --> <ul class="ArticleMeta_tags__30Wbg"><li><a class=" " href="/tags/sketch/">sketch</a></li></ul> <!-- -->â€¢<!-- --> <span>â˜•ï¸<!-- --> <!-- -->3<!-- --> min read</span></small></header><div class="BlogPostLayout_content__1CRXP"><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸»è¦åˆ†äº«ä¸€ä¸‹ sketch æ’ä»¶å¼€å‘çš„ä¸€äº›ç»éªŒå’Œå¿ƒå¾—ã€‚</p><p>åœ¨æ”¶åˆ°ä»»åŠ¡è¦å¼€å‘ sketch æ’ä»¶çš„æ—¶å€™å°±å¤§é‡çš„å»å¯»æ‰¾èµ„æ–™ã€‚ä½†æ˜¯å‘ç° github ä¸Šå¾ˆå¤šéƒ½æ˜¯ç”¨ <code>OC</code> å’Œ <code>JS</code> æ··åˆå†™çš„ã€‚ä½†æ˜¯å› ä¸ºæˆ‘æ²¡å¤šå°‘æ—¶é—´å»å­¦ä¹  <code>OC</code> çš„å†™æ³•ï¼Œ
å¹¶ä¸”åœ¨ <code>sketch</code> <a class=" " href="https://developer.sketch.com/">å®˜ç½‘</a>ä¸Šä¹Ÿè¯´äº†ã€‚<code>sketch</code> å‡çº§çš„æ—¶å€™æœ‰å¯èƒ½å†…éƒ¨çš„ <code>api</code> ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä½†æ˜¯æš´éœ²å‡ºå»çš„ <code>js api</code> åŸºæœ¬æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚
æ‰€ä»¥æœ€ç»ˆå†³å®šå…¨éƒ¨é‡‡ç”¨ <code>js</code> çš„å†™æ³•ã€‚</p><h2 id="ç›®å½•">ç›®å½•</h2><ul><li>sketch å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜<ul><li>å¦‚ä½•å®šä¹‰èœå•</li><li>å¦‚ä½•è§¦å‘ action</li><li>å¦‚ä½•æ„å»º webview</li><li>webview ä¸ sketch æ˜¯å¦‚ä½•é€šä¿¡çš„</li><li>ç¯å¢ƒé…ç½®</li><li>æ„å»º</li><li>å‘å¸ƒ</li></ul></li><li>å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜</li></ul><h3 id="å¦‚ä½•å®šä¹‰èœå•">å¦‚ä½•å®šä¹‰èœå•</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ sketch æ’ä»¶çš„æ—¶å€™ç»å¸¸ä¼šçœ‹åˆ°è¿™äº›èœå•ã€‚æ¯”å¦‚ antd çš„ <code>kitchen</code> æ’ä»¶ã€‚æ‰€æœ‰çš„æ’ä»¶éƒ½å¯ä»¥<a class=" " href="https://github.com/sketchplugins/plugin-directory">åœ¨è¿™é‡Œæ‰¾åˆ°</a></p><div><img src="/static/media/1.f12b94d3.jpg"/></div><p>è¿™æ˜¯ä¸€ä¸ªæ’ä»¶çš„å·¥å…·æ ã€‚é‚£ä¹ˆè¿™ä¸ªå·¥å…·æ æ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„å‘¢ï¼Ÿåœ¨ sketch ä¸­æœ‰ä¸€ä¸ªå«åš <code>manifest.json</code> çš„æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ’ä»¶ä¸­å¯ä»¥å®šä¹‰è¿™æ ·çš„ä¸€ç³»åˆ—èœå•ã€‚çœ‹ä¸‹ antd çš„ <code>manifest.json</code> çš„
å®šä¹‰ã€‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token string">"commands"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"action.js"</span><span class="token punctuation">,</span>
      <span class="token string">"handlers"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"actions"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">"Startup"</span><span class="token punctuation">:</span> <span class="token string">"onStartup"</span><span class="token punctuation">,</span>
          <span class="token string">"Shutdown"</span><span class="token punctuation">:</span> <span class="token string">"onShutdown"</span><span class="token punctuation">,</span>
          <span class="token string">"ToggleInspectorVisibility.begin"</span><span class="token punctuation">:</span> <span class="token string">"onToggleInterface"</span><span class="token punctuation">,</span>
          <span class="token string">"OpenDocument"</span><span class="token punctuation">:</span> <span class="token string">"onOpenDocument"</span><span class="token punctuation">,</span>
          <span class="token string">"CloseDocument"</span><span class="token punctuation">:</span> <span class="token string">"onCloseDocument"</span><span class="token punctuation">,</span>
          <span class="token string">"SelectionChanged.finish"</span><span class="token punctuation">:</span> <span class="token string">"onSelectionChanged"</span><span class="token punctuation">,</span>
          <span class="token string">"TextChanged"</span><span class="token punctuation">:</span> <span class="token string">"onTextChanged"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
      <span class="token string">"identifier"</span><span class="token punctuation">:</span> <span class="token string">"showToolbar"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"åˆ‡æ¢å·¥å…·æ "</span><span class="token punctuation">,</span>
      <span class="token string">"shortcut"</span><span class="token punctuation">:</span> <span class="token string">"ctrl alt k"</span><span class="token punctuation">,</span>
      <span class="token string">"handler"</span><span class="token punctuation">:</span> <span class="token string">"onShow"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
      <span class="token string">"identifier"</span><span class="token punctuation">:</span> <span class="token string">"uploadArtboards"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Artboard ä¸Šä¼ "</span><span class="token punctuation">,</span>
      <span class="token string">"shortcut"</span><span class="token punctuation">:</span> <span class="token string">"ctrl alt a"</span><span class="token punctuation">,</span>
      <span class="token string">"handler"</span><span class="token punctuation">:</span> <span class="token string">"onUploadArtboards"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
      <span class="token string">"identifier"</span><span class="token punctuation">:</span> <span class="token string">"syncSymbols"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Symbol åŒæ­¥"</span><span class="token punctuation">,</span>
      <span class="token string">"shortcut"</span><span class="token punctuation">:</span> <span class="token string">"ctrl alt w"</span><span class="token punctuation">,</span>
      <span class="token string">"handler"</span><span class="token punctuation">:</span> <span class="token string">"onSyncSymbols"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
      <span class="token string">"identifier"</span><span class="token punctuation">:</span> <span class="token string">"resource"</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Iconfont"</span><span class="token punctuation">,</span>
      <span class="token string">"shortcut"</span><span class="token punctuation">:</span> <span class="token string">"ctrl alt i"</span><span class="token punctuation">,</span>
      <span class="token string">"handler"</span><span class="token punctuation">:</span> <span class="token string">"onResource"</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>other commands
<span class="token punctuation">]</span>
</code></pre><p>è¿™ä¸ªä»£ç ä¸­ <code>name</code> å±æ€§ä»£è¡¨çš„æ˜¯èœå•çš„åå­—ã€‚å¯ä»¥çœ‹å‡ºå®Œå…¨ç¬¦åˆä¸Šè¿°æˆªå›¾çš„éƒ¨åˆ†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå®šä¹‰çš„æ¯ä¸ª <code>action</code> éƒ½æ˜¯å®šä¹‰åœ¨ <code>commands</code> è¿™ä¸ªå¯¹è±¡ä¸‹é¢ã€‚
<code>identifier</code> æ˜¯æ¯ä¸ªå®šä¹‰çš„èœå•çš„æ ‡å¿—ã€‚ <code>shortcut</code> æ˜¯çŸ­å‘½ä»¤ã€‚å¯ä»¥ç”¨è¿‡å¿«æ·ç‚¹æ¥å¿«é€Ÿç‚¹å‡»èœå•ã€‚<code>handler</code> ä¸ºå‡½æ•°ï¼Œå°±æ˜¯ç‚¹å‡»è¿™ä¸ªèœå•éœ€è¦æ‰§è¡Œçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥è‡ªäº
<code>script</code> è¿™ä¸ªå­—æ®µå®šä¹‰çš„æ–‡ä»¶ä¸­ã€‚æ¯”å¦‚æ­¤æ—¶ <code>script</code> é‡Œæ˜¯ <code>index.js</code>, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°åº”è¯¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯å¯ä»¥æŸ¥åˆ°çš„ã€‚<a class=" " href="https://developer.sketch.com/plugins/">å…·ä½“å…¶ä»–çš„æŸ¥çœ‹å®˜ç½‘</a></p><h3 id="å¦‚ä½•è§¦å‘-action">å¦‚ä½•è§¦å‘ action</h3><p>å¦‚æœä»”ç»†çœ‹ä¸€ä¸‹ä¸Šè¿°ä»£ç ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æœ‰è¿™æ ·ä¸€ä¸ªä»£ç </p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token punctuation">{</span>
  <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"action.js"</span><span class="token punctuation">,</span>
  <span class="token string">"handlers"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"actions"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"Startup"</span><span class="token punctuation">:</span> <span class="token string">"onStartup"</span><span class="token punctuation">,</span>
      <span class="token string">"Shutdown"</span><span class="token punctuation">:</span> <span class="token string">"onShutdown"</span><span class="token punctuation">,</span>
      <span class="token string">"ToggleInspectorVisibility.begin"</span><span class="token punctuation">:</span> <span class="token string">"onToggleInterface"</span><span class="token punctuation">,</span>
      <span class="token string">"OpenDocument"</span><span class="token punctuation">:</span> <span class="token string">"onOpenDocument"</span><span class="token punctuation">,</span>
      <span class="token string">"CloseDocument"</span><span class="token punctuation">:</span> <span class="token string">"onCloseDocument"</span><span class="token punctuation">,</span>
      <span class="token string">"SelectionChanged.finish"</span><span class="token punctuation">:</span> <span class="token string">"onSelectionChanged"</span><span class="token punctuation">,</span>
      <span class="token string">"TextChanged"</span><span class="token punctuation">:</span> <span class="token string">"onTextChanged"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>ä»”ç»†çœ‹ä¸‹è¿™ä¸ªå®šä¹‰äº†ä¸€ä¸ªå«åš <code>handlers</code> çš„å¯¹è±¡ã€‚é‡Œé¢æœ‰ä¸€ä¸ªå«åš <code>actions</code>, è¿™ä¸ª <code>actions</code> çš„å®šä¹‰æ˜æ˜¾å’Œä¸Šè¿°èœå•çš„å®šä¹‰ä¸ä¸€æ ·å¯¹å—ï¼Ÿä¸Šé¢çš„èœå•çš„å®šä¹‰æ˜¯è¿™æ ·çš„</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token punctuation">{</span>
  <span class="token string">"script"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token string">"identifier"</span><span class="token punctuation">:</span> <span class="token string">"resource"</span><span class="token punctuation">,</span>
  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Iconfont"</span><span class="token punctuation">,</span>
  <span class="token string">"shortcut"</span><span class="token punctuation">:</span> <span class="token string">"ctrl alt i"</span><span class="token punctuation">,</span>
  <span class="token string">"handler"</span><span class="token punctuation">:</span> <span class="token string">"onResource"</span>
<span class="token punctuation">}</span>
</code></pre><p>é‚£ä¹ˆè¿™é‡Œçš„ <a class=" " href="https://developer.sketch.com/plugins/actions">actions</a> æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿè¿™äº› <code>actions</code> éƒ½æ˜¯ <code>sketch</code> å†…éƒ¨æš´éœ²å‡ºæ¥çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬è¿™ä¸ª
<code>action</code> æ¥å®ç°ä¸€äº›åŠŸèƒ½ã€‚æ¯”å¦‚ <code>OpenDocument</code> åœ¨æ‰“å¼€ä¸€ä¸ª sketch æ–‡ä»¶çš„æ—¶å€™åšä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚sketch ä¹Ÿå†…ç½®äº†å¯ä»¥ç›´æ¥æ‰§è¡Œä»£ç ã€‚</p><div><img src="/static/media/2.7eae8f95.png"/></div><p>ç‚¹å‡»è¿è¡Œä»£ç å°±å¯ä»¥ç›´æ¥è¿è¡Œä¸€äº›è„šæœ¬ã€‚æ‰€ä»¥å¦‚æœéœ€è¦ç”¨åˆ° <code>sketch</code> å†…éƒ¨å‘½ä»¤çš„æ—¶å€™, å°±å¯ä»¥å®šä¹‰è¿™äº› <code>action</code>, ç„¶ååœ¨å¯¹åº”çš„ <code>js</code> æ–‡ä»¶ä¸­å£°æ˜å¹¶ä¸” export å‡ºæ¥ã€‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token comment">// onOpenDocument</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">onOpenDocument</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"open document success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="å¦‚ä½•æ„å»º-webwiew">å¦‚ä½•æ„å»º webwiew</h3><p>å› ä¸ºåœ¨ github ä¸Šå¾ˆå¤šé¡¹ç›®éƒ½æ˜¯ç”¨ <code>OC</code> æ¥å†™çš„ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä¸ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>OC</code> æ¥åˆ›å»ºä¸€ä¸ª <code>webview</code> ã€‚è¿™é‡Œçš„ä»£ç éƒ½æ˜¯ <code>js</code> å†™çš„ã€‚æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸ªä¸»è¦çš„ç”¨äºåˆ›å»º <code>webview</code> çš„
åŒ… <a class=" " href="https://github.com/skpm/sketch-module-web-view">skpm-module-web-view</a> ã€‚å®‰è£…å¥½è¿™ä¸ªåŒ…å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…åˆå§‹åŒ–æ¨¡æ¿ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª <code>webview</code> çš„æ¨¡æ¿ã€‚è¿™ä¸ªä½¿ç”¨äº†
with-webview çš„æ¨¡æ¿</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="">skpm create my<span class="token operator">-</span>plugin<span class="token operator">-</span>name <span class="token operator">--</span>template<span class="token operator">=</span>skpm<span class="token operator">/</span><span class="token keyword">with</span><span class="token operator">-</span>webview
</code></pre><p>å…³äºè¿™ä¸ª webview çš„æ–‡æ¡£ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯ä¸¤éƒ¨åˆ†ã€‚</p><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ <a class=" " href="https://github.com/skpm/sketch-module-web-view/blob/master/docs/browser-window.md">brower-window</a> å¦‚ä½•åˆ›å»ºä¸€ä¸ª webview,
å¹¶ä¸”å¦‚ä½•åŠ è½½ä¸€ä¸ªé¡µé¢ã€‚è¿™ä¸ªé¡µé¢å¯ä»¥æ˜¯æ¥è‡ªäº server ä¹Ÿå¯ä»¥æ˜¯æ¥è‡ªäºæœ¬åœ°ã€‚</p><h3 id="webview-ä¸-sketch-æ˜¯å¦‚ä½•é€šä¿¡çš„">webview ä¸ sketch æ˜¯å¦‚ä½•é€šä¿¡çš„</h3><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯ webview ä¸ sketch <a class=" " href="https://github.com/skpm/sketch-module-web-view/blob/master/docs/communication-plugin-webview.md">å¦‚ä½•é€šä¿¡</a> æ¯”å¦‚ webview ç»™ sketch
å‘é€ä¿¡æ¯</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="">window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">"nativeLog"</span><span class="token punctuation">,</span> <span class="token string">"Called from the webview"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// you can pass any argument that can be stringified</span>
window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">"nativeLog"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> b
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// you can also pass multiple arguments</span>
window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">"nativeLog"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `window.postMessage` returns a Promis with the array of results from plugin listeners</span>
window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">"nativeLog"</span><span class="token punctuation">,</span> <span class="token string">"blabla"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// res === ['result']</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>ä½¿ç”¨ <code>postMessage</code> æ¥å‘é€æ¶ˆæ¯åˆ° <code>sketch</code> ä¸­ã€‚åœ¨ sketch ä¸­é€šè¿‡</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">var</span> sketch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"sketch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

browserWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"nativeLog"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sketch<span class="token punctuation">.</span><span class="token constant">UI</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token string">"result"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>æ¥æ¥æ”¶ <code>web-view</code> å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚</p><p>sketch ç»™ webView å‘é€æ¶ˆæ¯ã€‚é¦–å…ˆåœ¨ webview ä¸­å®šä¹‰æ–¹æ³•ã€‚æ³¨æ„éœ€è¦æŒ‚è½½åˆ° <code>window</code> ä¸Š</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="">window<span class="token punctuation">.</span><span class="token function-variable function">someGlobalFunctionDefinedInTheWebview</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>åœ¨ <code>sketch</code> ä¸­è°ƒç”¨ <code>executeJavaScript</code> æ–¹æ³•ã€‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="">browserWindow<span class="token punctuation">.</span>webContents
  <span class="token punctuation">.</span><span class="token function">executeJavaScript</span><span class="token punctuation">(</span><span class="token string">'someGlobalFunctionDefinedInTheWebview("hello")'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with the result</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¼ é€’ç»™ function ä¸­çš„å€¼ä¸€å®šè¦æ˜¯ä¸€ä¸ª string, å¯ä»¥ä½¿ç”¨ <code>JSON.stringify()</code> æ¥è½¬æˆ <code>string</code></p><h3 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h3><p>æœ‰çš„æ—¶å€™æ˜¯éœ€è¦è¿›è¡Œç¯å¢ƒé…ç½®çš„ã€‚å› ä¸ºå¯èƒ½åœ¨æµ‹è¯•ç¯å¢ƒéœ€è¦åŠ è½½æµ‹è¯•ç¯å¢ƒçš„ <code>url</code>, æ­£å¼ç¯å¢ƒéœ€è¦åŠ è½½æ­£å¼ç¯å¢ƒçš„ <code>url</code>ã€‚æ‰€ä»¥æ˜¯éœ€è¦åŒºåˆ†çš„ã€‚é‚£ä¹ˆåº”è¯¥å¦‚ä½•å»åšå‘¢ï¼Ÿ
åœ¨ Node ä¸­é€šè¿‡å¤§å®¶ä¼šä½¿ç”¨ <code>process.env</code> è¿™ä¸ªã€‚åœ¨ <code>sketch</code> ä¸­å¦‚æœä½¿ç”¨äº† <code>sketch-module-web-view</code>, é‚£ä¹ˆæ˜¯å¯ä»¥è‡ªå®šä¹‰ webpack ç¯å¢ƒçš„ã€‚æ‰€ä»¥æƒ³è®¾ç½®
ä¸åŒçš„ç¯å¢ƒå¯ä»¥è¿™æ ·æ¥åšã€‚é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªåå­—å« <code>webpack.skpm.config.js</code> æ–‡ä»¶ã€‚é‡Œé¢çš„ä»£ç </p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"webpack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>EnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token string">"development"</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>é€šè¿‡è¿™æ ·é…ç½®å¯ä»¥è®¾ç½® <code>NODE_ENV</code> é»˜è®¤ä¸º <code>development</code>ã€‚è¿™ä¸ªå¤§å®¶ä¹Ÿå¯ä»¥è®¾ç½®å…¶ä»–çš„ã€‚è¿™ä¸ªå°±æ˜¯ä¸ºäº†å†…éƒ¨è¿›è¡Œç¯å¢ƒçš„åŒºåˆ†çš„ã€‚ç„¶åå¯ä»¥é…ç½®ç›¸åº”çš„å‘½ä»¤ã€‚åœ¨ <code>package.json</code> ä¸­</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token string">"start"</span><span class="token punctuation">:</span> <span class="token string">"NODE_ENV=development skpm-build --watch --run"</span><span class="token punctuation">,</span>
<span class="token string">"start:test"</span><span class="token punctuation">:</span> <span class="token string">"NODE_ENV=test skpm-build --watch --run"</span><span class="token punctuation">,</span>
<span class="token string">"start:pro"</span><span class="token punctuation">:</span> <span class="token string">"NODE_ENV=production  yarn start"</span><span class="token punctuation">,</span>
</code></pre><p>å¯ä»¥é€šè¿‡ä¸åŒçš„å‘½ä»¤æ¥è¿è¡Œä¸åŒçš„ç¯å¢ƒã€‚åˆ°è¿™é‡ŒåŸºæœ¬çš„æ“ä½œåº”è¯¥éƒ½æ˜¯å¯ä»¥å®Œæˆçš„ã€‚</p><h3 id="æ„å»ºå’Œå‘å¸ƒ">æ„å»ºå’Œå‘å¸ƒ</h3><p>å¦‚æœæ˜¯åœ¨ github ä¸Šçš„è¯å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>skpm</code> å†…ç½®çš„æ„å»ºå‘½ä»¤ä»¥åŠå‘å¸ƒï¼Œå…¶ä»–çš„ä¸åŒæ‹…å¿ƒã€‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token string">"postinstall"</span><span class="token punctuation">:</span> <span class="token string">"npm run build &amp;&amp; skpm-link"</span>
</code></pre><p>ä½†æ˜¯æˆ‘è¿™é‡Œä¸»è¦è®²çš„æ˜¯åœ¨å…¬å¸å†…éƒ¨å¦‚ä½•å‘å¸ƒè¿™ä¸ªã€‚é¦–å…ˆå¯ä»¥æŸ¥çœ‹<a class=" " href="https://developer.sketch.com/plugins/publish-a-plugin">å®˜ç½‘å‘å¸ƒæµç¨‹</a>ã€‚æ€•æœ‰äº›äººä¼šå’Œä¸€æ ·ä¸€å¼€å§‹éƒ½æ˜¯ä¸æ€ä¹ˆç†è§£
è¿™ä¸ªå‘å¸ƒã€‚æ‰€ä»¥æˆ‘è¯¦ç»†è®²è§£ä¸€ä¸‹è¿™ä¸ªå‘å¸ƒã€‚é¦–å…ˆçœ‹å®˜ç½‘ä»‹ç»éœ€è¦ä¸€ä¸ª <code>appcast.xml</code> çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥é€‰æ‹©æ”¾åœ¨æœåŠ¡å™¨ä¸­ã€‚åªè¦å¯ä»¥è®¿é—®åˆ°å°±å¯ä»¥ã€‚å…¶å®å¯ä»¥çœ‹ä¸‹ <code>kitchen</code> çš„ <code>appcast.xml</code></p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token string">"appcast"</span><span class="token punctuation">:</span> <span class="token string">"https://kitchen.alipay.com/appcast.xml"</span><span class="token punctuation">,</span>
</code></pre><p>ç‚¹å‡»è¿™ä¸ªæ˜¯å®Œå…¨å¯ä»¥è®¿é—®çš„ã€‚é‚£ä¹ˆåœ¨å†…éƒ¨æ¯”å¦‚æˆ‘ä»¬ä¹Ÿç”Ÿæˆè¿™æ ·ä¸€ä¸ª <code>xml</code> æ–‡ä»¶ã€‚è¿™ä¸ªå¯ä»¥è®©æœåŠ¡ç«¯å¸®ä½ ç”Ÿæˆã€‚æ¯”å¦‚ç”Ÿæˆçš„åœ°å€æ˜¯ <code>http://xxx.yyy.com/appcast.xml</code> ã€‚ç„¶ååœ¨
<code>manifest.json</code> æ–‡ä»¶ä¸­å®šä¹‰è¿™æ ·ä¸€ä¸ªå­—æ®µå«åš <code>appcast</code> è¿™ä¸ªå­—æ®µçš„ value å°±æ˜¯è¿™ä¸ª urlã€‚é‚£ä¹ˆè¿™ä¸ªé‡Œé¢åº”è¯¥æ”¾å“ªäº›å†…éƒ¨å‘¢ï¼Ÿä¸å¦¨ä»¥ <code>kitchen</code> ä¸ºä¾‹å­ã€‚</p><div><img src="/static/media/3.234ad5a4.png"/></div><p>å¯ä»¥çœ‹å‡ºæ¯ä¸ª <code>item</code> ä¸‹é¢éƒ½æœ‰æ¯ä¸ªç‰ˆæœ¬çš„å…·ä½“åŒ…çš„åœ°å€ï¼Œæ‰€ä»¥è¿™æ˜¯å¿…è¦çš„ã€‚åœ¨ <code>appcast.xml</code> ä¸­åº”è¯¥åŒ…å«æ¯ä¸ªç‰ˆæœ¬çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬<code>ç‰ˆæœ¬å·</code>ä»¥åŠç›¸åº”çš„åŒ…çš„åœ°å€ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åŠ ä¸Šæ¯ä¸ª
ç‰ˆæœ¬çš„æè¿°ä¿¡æ¯ã€‚å½“å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬åã€‚åœ¨ sketch ä¸­å°±ä¼šæ˜¾ç¤ºæœ‰æ–°çš„ç‰ˆæœ¬éœ€è¦æ›´æ–°ã€‚</p><div><img src="/static/media/4.91119792.png"/></div><h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3><p>ä¸Šé¢å°±æ˜¯åœ¨å¼€å‘ <code>sketch</code> æ’ä»¶ä¸­ä¸€ä¸ªæµç¨‹éœ€è¦æ³¨æ„çš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚åé¢è¿˜æ˜¯é‡åˆ°å¾ˆå¤šé—®é¢˜çš„ï¼Œé‚£ä¹ˆè¯¦ç»†çš„æ–‡æ¡£éƒ½å¯ä»¥å‚è€ƒ<a class=" " href="https://developer.sketch.com/plugins/reference">api æ–‡æ¡£</a>
åœ¨è¿™ä¸ªæ–‡æ¡£ä¸­ä»‹ç»äº†å¾ˆå¤šåŠŸèƒ½ã€‚å¦‚ä½•å»è·å–å›¾å±‚ã€é€‰ä¸­çš„ç”»æ¿ã€åˆ›å»ºç”»æ¿ç­‰ç­‰ã€‚ä»¥åŠå¯¼å‡ºå¯¼å…¥è¿™äº›ã€‚å½“ç„¶ç›®å‰ js å¼€æ”¾çš„ api ä¸æ˜¯ç‰¹åˆ«çš„å¤šï¼Œä½†æ˜¯å¾ˆå¤šå°åŠŸèƒ½éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚å¦‚æœå‘ç°æœ‰ä¸èƒ½å®ç°çš„
å¯ä»¥æéœ€æ±‚ç»™ <code>sketch</code> çš„ã€‚</p><p>æœ€åå°±æ˜¯ä»‹ç»ä¸€ä¸ª sketch è®¨è®ºçš„ç½‘ç«™ã€‚å¾ˆå¤šäººä¼šåœ¨<a class=" " href="https://sketchplugins.com/">ä¸Šé¢</a>è®¨è®ºå¼€å‘ <code>sketch</code> é‡åˆ°çš„é—®é¢˜ </p></div><footer class="BlogPostLayout_footer__1p0Ii"><h3 class="BlogPostLayout_title__1egAZ"><a class=" " href="/">lanyincao</a></h3><div class="
      Bio_Bio__1eiKY
      BlogPostLayout_bio__2AHhA
    "><img src="/static/media/bio-pic.fdbb64ab.jpeg" alt="lanyincao"/><p>Personal blog by <a href="https://twitter.com/lanyincao">lanyincao</a>.<br/>I can&#x27;t sing, dance, rap but can code, ğŸ€</p></div><section class="BlogPostLayout_links__1fVhZ"><a class=" " href="/posts/2019-11-27/suiwen/">â† <!-- -->éšæ–‡</a><a class="BlogPostLayout_next__3tOcG " href="/posts/2019-11-24/how-to-study/">how to study<!-- --> â†’</a></section></footer></article></main></div></div><script>!function(o){function e(e){for(var t,r,n=e[0],c=e[1],f=e[2],d=0,a=[];d<n.length;d++)r=n[d],l[r]&&a.push(l[r][0]),l[r]=0;for(t in c)Object.prototype.hasOwnProperty.call(c,t)&&(o[t]=c[t]);for(p&&p(e);a.length;)a.shift()();return i.push.apply(i,f||[]),u()}function u(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var f=r[c];0!==l[f]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},a={43:0},l={43:0},i=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(i){var e=[];a[i]?e.push(a[i]):0!==a[i]&&{1:1,23:1}[i]&&e.push(a[i]=new Promise(function(e,n){for(var t="static/css/"+({}[i]||i)+"."+{1:"27c8494b",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"31d6cfe0",15:"31d6cfe0",16:"31d6cfe0",17:"31d6cfe0",18:"31d6cfe0",19:"31d6cfe0",20:"31d6cfe0",21:"31d6cfe0",22:"31d6cfe0",23:"d3b34b05",24:"31d6cfe0",25:"31d6cfe0",26:"31d6cfe0",27:"31d6cfe0",28:"31d6cfe0",29:"31d6cfe0",30:"31d6cfe0",31:"31d6cfe0",32:"31d6cfe0",33:"31d6cfe0",34:"31d6cfe0",35:"31d6cfe0",36:"31d6cfe0",37:"31d6cfe0",38:"31d6cfe0",39:"31d6cfe0",40:"31d6cfe0",41:"31d6cfe0"}[i]+".chunk.css",c=s.p+t,r=document.getElementsByTagName("link"),f=0;f<r.length;f++){var d=(o=r[f]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(d===t||d===c))return e()}var a=document.getElementsByTagName("style");for(f=0;f<a.length;f++){var o;if((d=(o=a[f]).getAttribute("data-href"))===t||d===c)return e()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=e,u.onerror=function(e){var t=e&&e.target&&e.target.src||c,r=new Error("Loading CSS chunk "+i+" failed.\n("+t+")");r.request=t,n(r)},u.href=c,document.getElementsByTagName("head")[0].appendChild(u)}).then(function(){a[i]=0}));var r=l[i];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[i]=[e,t]});e.push(r[2]=t);var n,c=document.getElementsByTagName("head")[0],f=document.createElement("script");f.charset="utf-8",f.timeout=120,s.nc&&f.setAttribute("nonce",s.nc),f.src=s.p+"static/js/"+({}[i]||i)+"."+{1:"18016ef5",2:"f51ae852",3:"2d812e0c",4:"959e45b9",5:"031228ef",6:"da64b01a",7:"c20265b4",8:"3708fc80",9:"76d5a1f1",10:"64d279dc",11:"15bdaa3d",12:"a289339e",13:"6ed3fae5",14:"c0219476",15:"1b2dfa34",16:"c95df50e",17:"854d2668",18:"fe4e0156",19:"75b2ab08",20:"5cc3e2dd",21:"85a6bb34",22:"f5b6dab9",23:"873b678f",24:"299ad1b2",25:"26732315",26:"8ed938bb",27:"9e08b9c8",28:"8c5bf47d",29:"651315e7",30:"4de03612",31:"a827ef55",32:"9f8e8c89",33:"4e98a6ac",34:"8fa7acd9",35:"f7fd16e7",36:"c8a9136e",37:"7fd46dad",38:"ab859197",39:"242ef20f",40:"a8b763a6",41:"fe59cd2f"}[i]+".chunk.js",n=function(e){f.onerror=f.onload=null,clearTimeout(d);var t=l[i];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,c=new Error("Loading chunk "+i+" failed.\n("+r+": "+n+")");c.type=r,c.request=n,t[1](c)}l[i]=void 0}};var d=setTimeout(function(){n({type:"timeout",target:f})},12e4);f.onerror=f.onload=n,c.appendChild(f)}return Promise.all(e)},s.m=o,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var c=0;c<t.length;c++)e(t[c]);var p=n;u()}([])</script><script src="/static/js/42.e4ff5a7a.chunk.js"></script><script src="/static/js/main.763db4b1.chunk.js"></script></body></html>