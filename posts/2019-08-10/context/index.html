<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="shortcut icon" href="/fa.jpg"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="theme-color" content="#000000"/><link rel="manifest" href="/manifest.json"/>
    <title>React Context ğŸ˜</title>
    <link rel="canonical" href="/posts/2019-08-10/context" />
    <link rel="stylesheet" href="/static/css/1.27c8494b.chunk.css" />
  <link href="/static/css/main.0e6724e3.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__1wjbv"><div class="
        LoadingIndicator_LoadingIndicator__LXZCC
        
        undefined
      "></div><header><h3 class="BlogLayout_title__U0zfd"><a class=" " href="/">lanyincao</a></h3></header><main><article><header class="BlogPostLayout_header__6lPZ1"><h1 class="BlogPostLayout_title__1egAZ"><a class=" " href="/posts/2019-08-10/context/">React Context ğŸ˜</a></h1><small><time dateTime="Fri, 09 Aug 2019 16:00:00 GMT">August 10, 2019</time> <!-- -->â€¢<!-- --> <ul class="ArticleMeta_tags__30Wbg"><li><a class=" " href="/tags/react/">react</a></li><li><a class=" " href="/tags/context/">context</a></li></ul> <!-- -->â€¢<!-- --> <span>â˜•ï¸<!-- --> <!-- -->3<!-- --> min read</span></small></header><div class="BlogPostLayout_content__1CRXP"><h1 id="context">Context</h1><p><a class=" " href="https://reactjs.org/docs/context.html#when-to-use-context">context</a> åœ¨ react ä¸­æ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿ï¼Œ<code>context</code> çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³åœ¨ react ä¸­ä¼ é€’ props éœ€è¦å¤šå±‚ä¼ é€’çš„é—®é¢˜ï¼Œ
åœ¨ä½¿ç”¨äº† context ä¹‹åå¯ä»¥æœ‰æ•ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä» 15 ç‰ˆæœ¬åˆ° 16 ç‰ˆæœ¬, <code>context</code> çš„ api ä¹Ÿå‘ç”Ÿäº†ä¸å°‘çš„å˜åŒ–ã€‚å…ˆçœ‹ä¸‹åœ¨ class ä¸­å¦‚ä½•ä½¿ç”¨ context</p><h2 id="class-context">Class Context</h2><p>é¦–å…ˆéœ€è¦å…ˆå£°æ˜ä¸€ä¸ª context, å¦‚ä½•å£°æ˜ï¼Ÿ</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> context <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>é€šè¿‡è°ƒç”¨ <code>React.createContext</code> æ¥åˆ›å»ºä¸€ä¸ª context çš„å£°æ˜, å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿæ¯”å¦‚æ­¤æ—¶æœ‰çˆ¶ç»„ä»¶å«åš app</p><p>app.js</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'lanyincao'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">updateState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>context<span class="token punctuation">.</span>Provider
          value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">,</span> updateState<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateState <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token punctuation">.</span>Provider<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>å¯ä»¥é€šè¿‡è°ƒç”¨ <code>context.Provider</code> æ¥ä½œä¸ºçˆ¶ç»„ä»¶çš„é‚£ä¸€å±‚ï¼Œæ­¤æ—¶éœ€è¦æ¥å—ä¸€ä¸ª <code>value</code> çš„ props, æ¯æ¬¡ value å‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šè§¦å‘ <code>context</code> çš„é‡æ–°æ¸²æŸ“ã€‚</p><p>æ—¢ç„¶ <code>context</code> çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³ props ä¼ é€’çš„é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨å­ç»„ä»¶ä¸­æ˜¯å¦‚ä½•æ‹¿åˆ°åœ¨ app.js ä¸­çš„æ•°æ®å‘¢, å‡è®¾æ­¤æ—¶æœ‰å­ç»„ä»¶å« <code>ExampleA.js</code></p><p>ExampleA.js</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ExampleA</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">{</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span>xxxx<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>åœ¨å­ç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨ <code>context.Consumer</code>, è¿™æ˜¯ä¸€ä¸ª <a class=" " href="https://reactjs.org/docs/render-props.html#use-render-props-for-cross-cutting-concerns">render props</a> ç»„ä»¶, æ¥æ”¶ä¸€ä¸ªå‚æ•°å«åš
<code>value</code>, æ­¤æ—¶çš„ <code>value</code> å°±æ˜¯ <code>context.Provider</code> ä¼ é€’ä¸‹æ¥çš„ <code>value</code>, æ‰€ä»¥å°±å¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨æ‹¿åˆ°çš„ <code>value</code>ã€‚</p><h2 id="tips">Tips</h2><p>åœ¨ä½¿ç”¨ <code>context</code> çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€äº›ç‚¹ï¼Œé¦–å…ˆ <code>context</code> æ˜¯æ— æ³•è¢« <code>bailout</code> æ„æ€å°±æ˜¯æ— è®ºä½ æ˜¯ä½¿ç”¨ <code>PureComponent</code> è¿˜æ˜¯ <code>memo</code> éƒ½æ˜¯æ— æ³•é˜»æ­¢ <code>context</code> çš„æ›´æ–°çš„ã€‚å¹¶ä¸”å¦‚æœ context æ‰€åœ¨çš„ç»„ä»¶æ²¡æœ‰æ›´æ–°ï¼Œä½†æ˜¯ context å‘ç”Ÿäº†æ›´æ–°ï¼Œ
é‚£ä¹ˆæ­¤æ—¶åªä¼šæ¸²æŸ“ <code>context</code> çš„éƒ¨åˆ†, æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç </p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ExampleB</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
              <span class="token operator">&lt;</span>div<span class="token operator">></span>
                name<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>age<span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
              <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">.</span>updateState<span class="token punctuation">}</span><span class="token operator">></span>updateAge<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>æ­¤æ—¶ç‚¹å‡» <code>updateAge</code> ä¼šè°ƒç”¨é¡¶å±‚çš„ <code>updateAge</code>, é‚£ä¹ˆ <code>app</code> ç»„ä»¶è¢«æ›´æ–°ï¼Œæ‰€ä»¥ <code>Provider</code> çš„ <code>value</code> å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥ <code>context</code> å°†ä¼šæ›´æ–°ã€‚ä½†æ˜¯ <code>ExampleB</code> ç»„ä»¶ä¸­çš„ <code>console.log(111)</code> å¹¶
æ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œé‡Œé¢çš„ <code>age</code> å´å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯ <code>react</code> æœ¬èº«åšçš„ä¼˜åŒ–ä¹‹ä¸€å§ï¼Œå‘ç”Ÿåšä¸å¿…è¦çš„æ¸²æŸ“ã€‚é‚£ä¹ˆåœ¨çœ‹ä¸‹ <code>ExampleC</code> ç»„ä»¶</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ExampleC</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
              <span class="token operator">&lt;</span>div<span class="token operator">></span>
                name<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>age<span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
              <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">.</span>updateState<span class="token punctuation">}</span><span class="token operator">></span>updateAge<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>æ­¤æ—¶ <code>ExampleC</code> ç»„ä»¶æ˜¯ <code>PureComponent</code>, <code>PureComponent</code> å¯¹ç»„ä»¶åšäº†éƒ¨åˆ†ä¼˜åŒ–ï¼Œå½“ <code>props</code> æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ˜¯ä¸ä¼š <code>render</code> çš„ï¼Œæ­¤æ—¶ <code>ExampleC</code> ç»„ä»¶æ²¡æœ‰å¤šä½™çš„ props, ç‚¹å‡» <code>updateAge</code>, ä¼šå‘ç° <code>ExampleC</code> ä¸­çš„
<code>age</code> ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯ <code>console.log(111)</code> ä»ç„¶ä¹Ÿæ²¡æœ‰è¾“å‡ºï¼Œæ‰€ä»¥æ— è®ºæ˜¯ <code>PureComponent</code> è¿˜æ˜¯ <code>memo</code>ï¼Œ <code>shouldComponentUpdate</code> éƒ½æ˜¯æ— æ³•é˜»æ­¢ <code>context</code> çš„æ›´æ–°çš„ã€‚</p><h2 id="hook-context">Hook Context</h2><p><code>React</code> å›¢é˜Ÿåœ¨å»å¹´ 10 æœˆä»½çš„ <code>conf</code> ä¸Šè®²åˆ°äº† <code>Hook</code>, å¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆ <code>Hook</code> è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿåœ¨ <code>class</code> ä¸­å¾ˆå¤šæ—¶å€™éœ€è¦ä½¿ç”¨ <code>Hoc</code>, <code>render props</code>, è¿™äº›é«˜é˜¶çš„æ–¹æ³•æ¥å°è£…ä¸€äº›æ–¹æ³•ï¼Œåœ¨ <code>js</code> ä¸­ï¼Œ
éƒ½çŸ¥é“<code>å›è°ƒåœ°ç‹±</code>ï¼Œ é‚£ä¹ˆåœ¨ <code>react</code> ä¸­å°±å­˜åœ¨äº†ä¸€ç§å«åš <code>åµŒå¥—åœ°ç‹±</code> çš„å½¢å¼ï¼Œæ¯”å¦‚</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
  <span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
          <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
              <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
                  <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>Hoc<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Hoc<span class="token operator">></span>
</code></pre><p>è¿™ç§æœ‰å¯èƒ½ä¼šåµŒå¥—çš„éå¸¸éå¸¸çš„ç¥ï¼Œå¯¹äºè°ƒè¯•æ¥è¯´ä¹Ÿä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚è¿™ä¹Ÿæ˜¯ <code>Hook</code> å‡ºæ¥çš„åŸå› ä¹‹ä¸€ã€‚å…·ä½“ <a class=" " href="https://reactjs.org/docs/hooks-intro.html">Hook ç”¨æ³•</a> å¯ä»¥å»å‚ç…§å®˜ç½‘å³å¯ã€‚</p><p>ä»Šå¤©åœ¨è¿™é‡Œä¸»è¦æ¥ä»‹ç»åœ¨ <code>Hook</code> ä¸­å¦‚ä½•ä½¿ç”¨ <code>context</code>ï¼Œ åœ¨ <code>Hook</code> æœ‰ä¸€ä¸ª <code>hook</code> å«åš <a class=" " href="https://reactjs.org/docs/hooks-reference.html#usecontext">useContext</a></p><p><code>éœ€è¦æ³¨æ„çš„æ˜¯æ‰€æœ‰çš„</code>Hook<code>åªèƒ½ç”¨äºå‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œå¦‚æœåœ¨ class ä¸­è¿˜éœ€è¦ç”¨ class çš„ç”¨æ³•</code></p><p>ä¸æ”¾æŠŠä¸Šé¢çš„ <code>ExampleB</code> ç»„ä»¶è¿›è¡Œæ”¹é€ æˆå‡½æ•°ç»„ä»¶</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ExampleB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        name<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">.</span>age<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">.</span>updateState<span class="token punctuation">}</span><span class="token operator">></span>updateAge<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>åœ¨å‡½æ•°é‡Œä½¿ç”¨äº† <code>useContext</code>, æ³¨æ„æ‰€æœ‰çš„ <code>Hook</code> éƒ½å¿…è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­çš„é¡¶å±‚ä½¿ç”¨ï¼ï¼ï¼
<code>useContext</code> æ¥æ”¶çš„å‚æ•°æ˜¯ <code>context</code>, è¿™ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸€ä¸‹</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers="">Correct<span class="token punctuation">:</span> <span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
Incorrect<span class="token punctuation">:</span> <span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
Incorrect<span class="token punctuation">:</span> <span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><code>useContext</code> çš„è¿”å›å€¼å°±æ˜¯ <code>context.Provider</code> çš„ <code>value</code> çš„å€¼ï¼Œå½“ <code>value</code> å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>context</code> çš„åœ°æ–¹å°±ä¼šå‘ç”Ÿæ›´æ–°ã€‚æ¯”å¦‚æ­¤æ—¶ç‚¹å‡»
<code>updateAge</code>ï¼Œ é‚£ä¹ˆ <code>ExampleB</code> å°±ä¼šå‘ç”Ÿæ›´æ–°ï¼Œ<code>age</code> å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>åœ¨ <code>Hook</code> ä¸­ä½¿ç”¨ <code>useContext</code> æä¸ºç®€å•ï¼Œä½†æ˜¯ä¸€å®šè¦è®°å¾—åœ¨<code>é¡¶å±‚ä½¿ç”¨</code>ã€‚<code>context</code> é€šå¸¸ä¼šä¸ <code>useReducer</code> ä¸€èµ·ä½¿ç”¨, æ¯”å¦‚åˆ›å»ºä¸€ä¸ªç®€å•çš„è¡¨å•ï¼Œå°±å¯ä»¥è¿™ä¹ˆå¤„ç†ã€‚è‡³äºå¦‚ä½•åˆ›å»º
é«˜æ•ˆçš„ <code>Form</code>, è¿™é‡Œå°±ä¸åšè¯¦ç»†çš„é˜è¿°ã€‚</p><h2 id="context-is-necessary">context is necessary?</h2><p><code>context</code> ä¸€èˆ¬èƒ½è§£å†³å¤§éƒ¨åˆ†çš„åœºæ™¯ï¼Œä½†æ˜¯æ˜¯å¦æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚åˆ <code>context</code> å‘¢ï¼Ÿç°åœ¨å¸‚åœºä¸Šæœ‰å¾ˆå¤šçš„çŠ¶æ€ç®¡ç†çš„åº“æ¯”å¦‚ <code>redux</code>, <code>mobx</code>, <code>rematch</code>, <code>reselect</code>, <code>dva</code> ç­‰ä¸€äº›åº“æ¥å¤„ç†
çŠ¶æ€çš„é—®é¢˜ã€‚è¿™äº›åº“å¯èƒ½å¤„ç†çš„ä¸ä»…ä»…æ˜¯çŠ¶æ€çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä¸€äº›å‰¯ä½œç”¨çš„å¤„ç†ç­‰ã€‚ä»¥ <code>react-redux</code> ä¸ºä¾‹</p><p>åœ¨ <code>react-redux</code> ä¸­ä¹Ÿä½¿ç”¨äº† context, ä½†æ˜¯å†…éƒ¨ä»£ç ç¡®é‡‡ç”¨äº† <code>subscriber</code> çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿåœ¨ <code>class</code> ä¸­è¯´è¿‡åªè¦ä½¿ç”¨ <code>context</code> çš„åœ°æ–¹,éƒ½ä¼šé€ æˆæ›´æ–°ï¼Œé‚£ä¹ˆæ¯”å¦‚åœ¨ A ç»„ä»¶ä¸­åªéœ€è¦ <code>age</code> å­—æ®µ
åœ¨ <code>B</code> ç»„ä»¶ä¸­åªéœ€è¦ <code>name</code> å­—æ®µï¼Œæ‰€å¸Œæœ›çš„æ˜¯åœ¨ä¿®æ”¹ <code>age</code> çš„æ—¶å€™ï¼Œ <code>B</code> ç»„ä»¶æ˜¯ä¸åº”è¯¥å‘ç”Ÿ <code>render</code> çš„ï¼Œæ‰€ä»¥ <code>react-redux</code> å†…éƒ¨é‡‡ç”¨äº†è¿™ç§æ–¹å¼æ¥å¤„ç† <code>context</code> å¼•èµ·çš„æ€§èƒ½é—®é¢˜ã€‚é€šå¸¸åœ¨æ—¥å¸¸çš„ä¸šåŠ¡ä»£ç ä¸­
ä¸ç”¨å¤ªå…³å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨ä½¿ç”¨ <code>context</code> çš„æ—¶å€™é€šå¸¸æ¶‰åŠçš„ç»„ä»¶æ•°é‡ä¸ä¼šå¾ˆå¤šï¼Œå³ä½¿å¤š <code>render</code> äº†å‡ æ¬¡ä¹Ÿä¸ä¼šé€ æˆå¤ªå¤§çš„å½±å“ã€‚</p><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ <code>context</code>ï¼Œåˆé‡åˆ°äº†åŒæ ·çš„æ€§èƒ½é—®é¢˜ï¼Œå¯èƒ½ä½ å¹¶ä¸æƒ³ç”¨ <code>react-redux</code>ï¼Œé‚£ä¹ˆæˆ‘æ¨èä½¿ç”¨ <a class=" " href="https://github.com/snakeUni/react-redux-chaos">react-redux-chaos</a> è¿™ä¸ªåº“ï¼Œè¿™ä¸ªåº“çš„å†™æ³•å¾ˆç®€å•ï¼Œä¹Ÿ
åšåˆ°äº†éƒ¨åˆ†æ¸²æŸ“ï¼Œä¿®æ”¹ A ç»„ä»¶å¹¶ä¸ä¼šå½±å“åˆ° B ç»„ä»¶ã€‚åªéœ€è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>useSelector</code> å³å¯</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux-chaos'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ExampleA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> getState<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      age<span class="token punctuation">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>age<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'updateAge'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>updateAge<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒå®˜ç½‘ã€‚</p><h2 id="conslusion">Conslusion</h2><p><code>context</code> è§£å†³äº†çŠ¶æ€å¤šå±‚ä¼ é€’çš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·ä¸€äº›æ€§èƒ½æ–‡è‰ºã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å¤ªå¤šå…³æ³¨è¿™ä¸ªæ€§èƒ½é—®é¢˜ï¼Œé™¤éçœŸæ­£çš„é‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚åœ¨å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ <code>useContext</code> æ–°çš„ <code>Hook</code> æ¥è¾¾åˆ°å’Œ class ä¸­
åŒæ ·çš„æ•ˆæœã€‚</p><h2 id="thanks">Thanks</h2></div><footer class="BlogPostLayout_footer__1p0Ii"><h3 class="BlogPostLayout_title__1egAZ"><a class=" " href="/">lanyincao</a></h3><div class="
      Bio_Bio__1eiKY
      BlogPostLayout_bio__2AHhA
    "><img src="/static/media/bio-pic.fdbb64ab.jpeg" alt="lanyincao"/><p>Personal blog by <a href="https://twitter.com/lanyincao">lanyincao</a>.<br/>I can&#x27;t sing, dance, rap but can code, ğŸ€</p></div><section class="BlogPostLayout_links__1fVhZ"><a class=" " href="/posts/2019-08-19/form/">â† <!-- -->ğŸ¤” Form</a><a class="BlogPostLayout_next__3tOcG " href="/posts/2019-06-03/state/">React Hooks State ğŸ¤”<!-- --> â†’</a></section></footer></article></main></div></div><script>!function(o){function e(e){for(var t,r,n=e[0],c=e[1],f=e[2],d=0,a=[];d<n.length;d++)r=n[d],l[r]&&a.push(l[r][0]),l[r]=0;for(t in c)Object.prototype.hasOwnProperty.call(c,t)&&(o[t]=c[t]);for(p&&p(e);a.length;)a.shift()();return i.push.apply(i,f||[]),u()}function u(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var f=r[c];0!==l[f]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},a={43:0},l={43:0},i=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(i){var e=[];a[i]?e.push(a[i]):0!==a[i]&&{1:1,23:1}[i]&&e.push(a[i]=new Promise(function(e,n){for(var t="static/css/"+({}[i]||i)+"."+{1:"27c8494b",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"31d6cfe0",15:"31d6cfe0",16:"31d6cfe0",17:"31d6cfe0",18:"31d6cfe0",19:"31d6cfe0",20:"31d6cfe0",21:"31d6cfe0",22:"31d6cfe0",23:"d3b34b05",24:"31d6cfe0",25:"31d6cfe0",26:"31d6cfe0",27:"31d6cfe0",28:"31d6cfe0",29:"31d6cfe0",30:"31d6cfe0",31:"31d6cfe0",32:"31d6cfe0",33:"31d6cfe0",34:"31d6cfe0",35:"31d6cfe0",36:"31d6cfe0",37:"31d6cfe0",38:"31d6cfe0",39:"31d6cfe0",40:"31d6cfe0",41:"31d6cfe0"}[i]+".chunk.css",c=s.p+t,r=document.getElementsByTagName("link"),f=0;f<r.length;f++){var d=(o=r[f]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(d===t||d===c))return e()}var a=document.getElementsByTagName("style");for(f=0;f<a.length;f++){var o;if((d=(o=a[f]).getAttribute("data-href"))===t||d===c)return e()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=e,u.onerror=function(e){var t=e&&e.target&&e.target.src||c,r=new Error("Loading CSS chunk "+i+" failed.\n("+t+")");r.request=t,n(r)},u.href=c,document.getElementsByTagName("head")[0].appendChild(u)}).then(function(){a[i]=0}));var r=l[i];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[i]=[e,t]});e.push(r[2]=t);var n,c=document.getElementsByTagName("head")[0],f=document.createElement("script");f.charset="utf-8",f.timeout=120,s.nc&&f.setAttribute("nonce",s.nc),f.src=s.p+"static/js/"+({}[i]||i)+"."+{1:"18016ef5",2:"f51ae852",3:"2d812e0c",4:"959e45b9",5:"031228ef",6:"da64b01a",7:"c20265b4",8:"3708fc80",9:"76d5a1f1",10:"64d279dc",11:"15bdaa3d",12:"a289339e",13:"6ed3fae5",14:"c0219476",15:"1b2dfa34",16:"c95df50e",17:"854d2668",18:"fe4e0156",19:"75b2ab08",20:"5cc3e2dd",21:"85a6bb34",22:"f5b6dab9",23:"873b678f",24:"299ad1b2",25:"26732315",26:"8ed938bb",27:"9e08b9c8",28:"8c5bf47d",29:"651315e7",30:"4de03612",31:"a827ef55",32:"9f8e8c89",33:"4e98a6ac",34:"8fa7acd9",35:"f7fd16e7",36:"c8a9136e",37:"7fd46dad",38:"ab859197",39:"242ef20f",40:"a8b763a6",41:"fe59cd2f"}[i]+".chunk.js",n=function(e){f.onerror=f.onload=null,clearTimeout(d);var t=l[i];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,c=new Error("Loading chunk "+i+" failed.\n("+r+": "+n+")");c.type=r,c.request=n,t[1](c)}l[i]=void 0}};var d=setTimeout(function(){n({type:"timeout",target:f})},12e4);f.onerror=f.onload=n,c.appendChild(f)}return Promise.all(e)},s.m=o,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var c=0;c<t.length;c++)e(t[c]);var p=n;u()}([])</script><script src="/static/js/42.e4ff5a7a.chunk.js"></script><script src="/static/js/main.763db4b1.chunk.js"></script></body></html>